<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>The Nature of Code</title>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="/book/javascripts/codeprocessing.js"></script>
	<script type="text/javascript" src="/book/processingjs/processing.js"></script>
  <script type="text/javascript" src="/book/processingjs/lazyloading.js"></script>
  <script type="text/javascript" src="/book/javascripts/sketchControls.js"></script>
  <script type="text/javascript" src="/book/javascripts/jquery.fixed.js"></script>

  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
      $('#toc-list').fixed({'top':'8'});
      $('#nav-bar-wrap').fixed({'top':'8'});

      $('span.c1').each(function(){ addStylesToCodeLines($(this)); });
      // $('code').each(function(){ inlineComments($(this)); });
      $('div.source-code').each(function(){ setRawCodeHeight($(this)); });
      $('a.toggle').click(function(){ toggleCodeDisplay($(this)); return false; });
    });
  </script>
	<link rel="stylesheet" href="/book/stylesheets/fonts.css" type="text/css">
	<link rel="stylesheet" href="/book/stylesheets/html.css" type="text/css">
	<link rel="stylesheet" href="/book/stylesheets/code-html.css">

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34673170-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<script>

    window.onload= function() {
      offsetUps = document.getElementsByClassName('offset-up');
      for(var i=0; i < offsetUps.length; i++) {
        var element = offsetUps[i];
        var comment = element.getElementsByClassName('code-comment')[0];
        var height = comment.offsetHeight;
        comment.style.top = '-' + (height) +  'px';
      }
    };
</script>

</head>
<body>

  <div id="navigator">
    <div id="navigator-inner">
      <div id='nav-bar-wrap'>
        <div id="mask"></div>
        <div id="nav-bar">
          <h1><a href="/">THE <strong>NATURE</strong> OF CODE</a></h1>
          <h2>by Daniel Shiffman</h2>
          <a id="purchase-link" href="/">Buy this book in print</a> <a id="purchase-link" href="/">Buy this book as PDF</a>
        </div>
      </div>
      <div id="toc-holder">
        <div id="toc-list">
          <ul>
            <li><a href="/book/">Welcome</a></li>
            <li><a href="/book/acknowledgments">Acknowledgments</a></li>
            <li><a href="/book/dedication">Dedication</a></li>
            <li><a href="/book/preface">Preface</a></li>
            <li><a href="/book/introduction">Introduction</a></li>
            <li><a href="/book/chapter-1-vectors">1.  Vectors</a></li>
            <li><a href="/book/chapter-2-forces">2.  Forces</a></li>
            <li><a href="/book/chapter-3-oscillation">3.  Oscillation</a></li>
            <li><a href="/book/chapter-4-particle-systems">4.  Particle Systems</a></li>
            <li><a href="/book/chapter-5-physics-libraries">5.  Physics Libraries</a></li>
            <li><a href="/book/chapter-6-autonomous-agents">6.  Autonomous Agents</a></li>
            <li><a href="/book/chapter-7-cellular-automata">7.  Cellular Automata</a></li>
            <li><a href="/book/chapter-8-fractals">8.  Fractals</a></li>
            <li><a href="/book/chapter-9-the-evolution-of-code">9.  The Evolution of Code</a></li>
            <li><a href="/book/chapter-10-neural-networks">10.  Neural Networks</a></li>
            <li><a href="/book/further-reading">Further Reading</a></li>
            <li><a href="/book/index">Index</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div id="top">
    <div id="header">
      <h1><a href="/">The <strong>Nature</strong> of Code</a></h1>
      <h2>Daniel Shiffman</h2>
    </div>
  </div>

  <div id="middle">

  	<div id="container">
  		<a id="_chapter_3_oscillation" style="display: block;"></a><h2 id="chapter-3-oscillation">Chapter 3.  Oscillation</h2>
<blockquote >
  “Trigonometry is a sine of the times.”
  
    <span class="attribution">
— Anonymous
</span>
  
</blockquote><p>In Chapters 1 and 2, we carefully worked out an object-oriented structure to make something move on the screen, using the concept of a vector to represent location, velocity, and acceleration driven by forces in the environment.   We could move straight from here into topics such as particle systems, steering forces, group behaviors, etc.  If we did that, however, we’d skip an important area of mathematics that we’re going to need: <strong><em>trigonometry</em></strong>, or the mathematics of triangles, specifically right triangles.</p>
<p>Trigonometry is going to give us a lot of tools.   We’ll get to think about angles and angular velocity and acceleration.  Trig will teach us about the sine and cosine functions, which when used properly can yield an nice ease-in, ease-out wave pattern.   It’s going to allow us to calculate more complex forces in an environment that involves angles, such as a pendulum swinging or a box sliding down an incline.</p>
<p>So this chapter is a bit of a mishmash. We’ll start with the basics of angles in Processing and cover many trigonometric topics, tying it all into forces at the end.  And by taking this break now, we’ll also pave the way for more advanced examples that require trig later in this book.</p>
<section><a id="chapter03_section1" style="display: block;"></a><h3 id="31-angles">3.1  Angles</h3><p><a id="angles-82397290-253f-0130-bb03-7cd1c3f718ad" style="display: block;"></a></p>
<p>OK. Before we can do any of this stuff, we need to make sure we understand what it means to be an angle in Processing.   If you have experience with Processing, you’ve undoubtedly encountered this issue while using the <span class="function">rotate()</span> function to rotate and spin objects.</p>
<p><a id="anglesmeasuring-in-degrees-82398d20-253f-0130-bb04-7cd1c3f718ad" style="display: block;"></a><a id="degrees-82399ec0-253f-0130-bb05-7cd1c3f718ad" style="display: block;"></a></p>
<p>The first order of business is to cover <strong><em>radians</em></strong> and <strong><em>degrees</em></strong>.  You’re probably familiar with the concept of an angle in <strong><em>degrees</em></strong>.  A full rotation goes from 0 to 360 degrees.   90 degrees (a right angle) is 1/4th of 360, shown below as two perpendicular lines.</p>
<a id="chapter03_figure1" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_01.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.1</p>
</div>
<p>It’s fairly intuitive for us to think of angles in terms of degrees.  For example, the square in Figure 3.2 is rotated 45 degrees around its center.</p>
<a id="chapter03_figure2" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_02.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.3</p>
</div>
<p><a id="anglesmeasuring-in-radians-8239e430-253f-0130-bb06-7cd1c3f718ad" style="display: block;"></a><a id="processingangles-measuring-in-8239fa20-253f-0130-bb07-7cd1c3f718ad" style="display: block;"></a><a id="radians-823a1240-253f-0130-bb08-7cd1c3f718ad" style="display: block;"></a></p>
<p>Processing, however, requires angles to be specified in <strong><em>radians</em></strong>.   A radian is a unit of measurement for angles defined by the ratio of the length of the arc of a circle to the radius of that circle.   One radian is the angle at which that ratio equals one (see Figure 3.1).  180 degrees = PI radians, 360 degrees = 2*PI radians, 90 degrees = PI/2 radians, etc.</p>
<a id="chapter03_figure3" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_03.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.3</p>
</div>
<p><a id="degreesradians-converting-to-823a3920-253f-0130-bb09-7cd1c3f718ad" style="display: block;"></a><a id="radiansconverting-from-degrees-823a4cb0-253f-0130-bb0a-7cd1c3f718ad" style="display: block;"></a></p>
<p>The formula to convert from degrees to radians is:</p>
<p>radians = 2 * PI * (degrees / 360)</p>
<p><a id="processingradians-function-823a6300-253f-0130-bb0b-7cd1c3f718ad" style="display: block;"></a><a id="radians-function-processing-823a7bc0-253f-0130-bb0c-7cd1c3f718ad" style="display: block;"></a></p>
<p>Thankfully, if we prefer to think in degrees but code with radians, Processing makes this easy.  The <span class="function">radians()</span> function will automatically convert values from degrees to radians, and the constants <span class="var">PI</span> and <span class="var">TWO_PI</span> provide convenient access to these commonly used numbers (equivalent to 180 and 360 degrees, respectively).   The following code, for example, will rotate shapes by 60 degrees.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float angle = radians(60);
rotate(angle);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">radians</span><span class="o">(</span><span class="mi">60</span><span class="o">);</span></span>
<span class='one-line'><span class="n">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="processingrotation-tutorial-823aa130-253f-0130-bb0d-7cd1c3f718ad" style="display: block;"></a></p>
<p>If you are not familiar with how rotation is implemented in Processing, I would suggest this tutorial: <a href="http://www.processing.org/learning/transform2d/">Processing - Transform 2D</a>.</p>
<p><a id="pi--823ab730-253f-0130-bb0e-7cd1c3f718ad" style="display: block;"></a><a id="pi-variable-processing-823ac460-253f-0130-bb0f-7cd1c3f718ad" style="display: block;"></a></p>
<div class="note">
  <h4 id="what-is-pi">What is PI?</h4><p>The mathematical constant pi (or π) is a real number defined as the ratio of a circle’s circumference (the distance around the perimeter) to its diameter (a straight line that passes through the circle’s center).  It is equal to approximately 3.14159 and can be accessed in Processing with the built-in variable <span class="var">PI</span>.</p>

</div><div style="page-break-after:always;"> </div><div class="example">
  <a id="chapter03_exercise1" style="display: block;"></a><h4 id="exercise-31">Exercise 3.1</h4><p>Rotate a baton-like object (see below) around its center using <span class="function">translate()</span> and <span class="function">rotate()</span>.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/Ex_3_01_exercise_baton/Ex_3_01_exercise_baton.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>

</div></section><section><a id="chapter03_section2" style="display: block;"></a><h3 id="32-angular-motion">3.2 Angular Motion</h3><p><a id="accelerationrotation-823afee0-253f-0130-bb10-7cd1c3f718ad" style="display: block;"></a><a id="anglesmotion-823b1420-253f-0130-bb11-7cd1c3f718ad" style="display: block;"></a><a id="motionangular-823b2630-253f-0130-bb12-7cd1c3f718ad" style="display: block;"></a><a id="rotation-823b3650-253f-0130-bb13-7cd1c3f718ad" style="display: block;"></a><a id="shapesrotating-823b4470-253f-0130-bb14-7cd1c3f718ad" style="display: block;"></a></p>
<p>Remember all this stuff?</p>
<p><span class="formula">location = location + velocity</span><br /><span class="formula">velocity = velocity + acceleration</span></p>
<p>The stuff we dedicated almost all of Chapters 1 and 2 to?  Well, we can apply exactly the same logic to a rotating object.</p>
<p><span class="formula">angle = angle + angular velocity</span><br /><span class="formula">angular velocity = angular velocity + angular acceleration</span></p>
<p>In fact, the above is actually simpler than what we started with because an angle is a <em>scalar</em> quantity—a single number, not a vector!</p>
<p>Using the answer from Exercise 3.1 above, let’s say we wanted to rotate a baton in Processing by some angle.  We would have code like:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  translate(width/2,height/2);
  rotate(angle);
  line(-50,0,50,0);
  ellipse(50,0,8,8);
  ellipse(-50,0,8,8);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="n">translate</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">line</span><span class="o">(-</span><span class="mi">50</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">50</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">ellipse</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">8</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">ellipse</span><span class="o">(-</span><span class="mi">50</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">8</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Adding in our principles of motion brings us to the following example.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_01_angular_motion/_3_01_angular_motion.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example1" style="display: block;"></a><span class="example">Example 3.1: Angular motion using rotate()</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>// Location
float angle = 0;
// Velocity
float aVelocity = 0;
// Acceleration
float aAcceleration = 0.001;

void setup() {
  size(640,360);
}

void draw() {
  background(255);

  fill(175);
  stroke(0);
  rectMode(CENTER);
  translate(width/2,height/2);
  rotate(angle);
  line(-50,0,50,0);
  ellipse(50,0,8,8);
  ellipse(-50,0,8,8);

  // Angular equivalent of velocity.add(acceleration);
  aVelocity += aAcceleration;
  // Angular equivalent of location.add(velocity);
  angle += aVelocity;
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair '><div class='code-comment '>Location</div><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Velocity</div><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">aVelocity</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Acceleration</div><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">aAcceleration</span> <span class="o">=</span> <span class="mf">0.001</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">640</span><span class="o">,</span><span class="mi">360</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">rectMode</span><span class="o">(</span><span class="n">CENTER</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">translate</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">line</span><span class="o">(-</span><span class="mi">50</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">50</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">ellipse</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">8</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">ellipse</span><span class="o">(-</span><span class="mi">50</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">8</span><span class="o">);</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Angular equivalent of velocity.add(acceleration);</div><code><pre><span class='one-line'>  <span class="n">aVelocity</span> <span class="o">+=</span> <span class="n">aAcceleration</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Angular equivalent of location.add(velocity);</div><code><pre><span class='one-line'>  <span class="n">angle</span> <span class="o">+=</span> <span class="n">aVelocity</span><span class="o">;</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>The baton starts onscreen with no rotation and then spins faster and faster as the angle of rotation accelerates.</p>
<p>This idea can be incorporated into our <span class="klass">Mover</span> object.  For example, we can add the variables related to angular motion to our <span class="klass">Mover</span>.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>class Mover {

  PVector location;
  PVector velocity;
  PVector acceleration;
  float mass;

  float angle = 0;
  float aVelocity = 0;
  float aAcceleration = 0;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Mover</span> <span class="o">{</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">location</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">velocity</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">acceleration</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">mass</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">aVelocity</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">aAcceleration</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>And then in <span class="function">update()</span>, we update both location and angle according to the same algorithm!</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea> void update() {

    //[full] Regular old-fashioned motion
    velocity.add(acceleration);
    location.add(velocity);
    //[end]

    //[full] Newfangled angular motion
    aVelocity += aAcceleration;
    angle += aVelocity;
    //[end]

    acceleration.mult(0);
  }</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Regular old-fashioned motion</div><code><pre><span class='one-line'>    <span class="n">velocity</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">acceleration</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">location</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">velocity</span><span class="o">);</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Newfangled angular motion</div><code><pre><span class='one-line'>    <span class="n">aVelocity</span> <span class="o">+=</span> <span class="n">aAcceleration</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">angle</span> <span class="o">+=</span> <span class="n">aVelocity</span><span class="o">;</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span>
<span class='one-line'>    <span class="n">acceleration</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Of course, for any of this to matter, we also would need to rotate the object when displaying it.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  void display() {
    stroke(0);
    fill(175,200);
    rectMode(CENTER);
    // pushMatrix() and popMatrix() are necessary
    // so that the rotation of this shape doesn’t
    // affect the rest of our world.
    pushMatrix();

    // Set the origin at the shape’s location.
    translate(location.x,location.y);
    // Rotate by the angle.
    rotate(angle);
    rect(0,0,mass*16,mass*16);
    popMatrix();
  }</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">,</span><span class="mi">200</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">rectMode</span><span class="o">(</span><span class="n">CENTER</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>pushMatrix() and popMatrix() are necessary
so that the rotation of this shape doesn’t
affect the rest of our world.</div><code><pre><span class='one-line'>    <span class="n">pushMatrix</span><span class="o">();</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Set the origin at the shape’s location.</div><code><pre><span class='one-line'>    <span class="n">translate</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Rotate by the angle.</div><code><pre><span class='one-line'>    <span class="n">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">mass</span><span class="o">*</span><span class="mi">16</span><span class="o">,</span><span class="n">mass</span><span class="o">*</span><span class="mi">16</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">popMatrix</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Now, if we were to actually go ahead and run the above code, we wouldn’t see anything new.  This is because the angular acceleration (<span class="function">float aAcceleration = 0;</span>) is initialized to zero.  For the object to rotate, we need to give it an acceleration!  Certainly, we could hard-code in a different number.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float aAcceleration = 0.01;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">aAcceleration</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>However, we can produce a more interesting result by dynamically assigning an angular acceleration according to forces in the environment.   Now, we could head far down this road, trying to model the physics of angular acceleration using the concepts of <a href="http://en.wikipedia.org/wiki/Torque">torque</a> and <a href="http://en.wikipedia.org/wiki/Moment_of_inertia">moment of inertia</a>.    Nevertheless, this level of simulation is beyond the scope of this book.  (We will see more about modeling angular acceleration with a pendulum later in this chapter, as well as look at how Box2D realistically models rotational motion in Chapter 5.)</p>
<p>For now, a quick and dirty solution will do.  We can produce reasonable results by simply calculating angular acceleration as a function of the object’s acceleration vector.  Here’s one such example:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>    aAcceleration = acceleration.x;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>    <span class="n">aAcceleration</span> <span class="o">=</span> <span class="n">acceleration</span><span class="o">.</span><span class="na">x</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Yes, this is completely arbitrary.  But it does do something.  If the object is accelerating to the right, its angular rotation accelerates in a clockwise direction; acceleration to the left results in a counterclockwise rotation.  Of course, it’s important to think about scale in this case. The <em>x</em> component of the acceleration vector might be a quantity that’s too large, causing the object to spin in a way that looks ridiculous or unrealistic.  So dividing the <em>x</em> component by some value, or perhaps constraining the angular velocity to a reasonable range, could really help.  Here’s the entire <span class="function">update()</span> function with these tweaks added.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_02_forces_angular_motion/_3_02_forces_angular_motion.pde /book/processingjs/chapter03/_3_02_forces_angular_motion/Attractor.pde /book/processingjs/chapter03/_3_02_forces_angular_motion/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example2" style="display: block;"></a><span class="example">Example 3.2: Forces with (arbitrary) angular motion</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  void update() {

    velocity.add(acceleration);
    location.add(velocity);

    // Calculate angular acceleration according to
    // acceleration’s horizontal direction and
    // magnitude.
    aAcceleration = acceleration.x / 10.0;
    aVelocity += aAcceleration;
    // Use constrain() to ensure that angular
    // velocity doesn’t spin out of control.
    aVelocity = constrain(aVelocity,-0.1,0.1);
    angle += aVelocity;

    acceleration.mult(0);
  }</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'> </span>
<span class='one-line'>    <span class="n">velocity</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">acceleration</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">location</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">velocity</span><span class="o">);</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Calculate angular acceleration according to
acceleration’s horizontal direction and
magnitude.</div><code><pre><span class='one-line'>    <span class="n">aAcceleration</span> <span class="o">=</span> <span class="n">acceleration</span><span class="o">.</span><span class="na">x</span> <span class="o">/</span> <span class="mf">10.0</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">aVelocity</span> <span class="o">+=</span> <span class="n">aAcceleration</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Use constrain() to ensure that angular
velocity doesn’t spin out of control.</div><code><pre><span class='one-line'>    <span class="n">aVelocity</span> <span class="o">=</span> <span class="n">constrain</span><span class="o">(</span><span class="n">aVelocity</span><span class="o">,-</span><span class="mf">0.1</span><span class="o">,</span><span class="mf">0.1</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">angle</span> <span class="o">+=</span> <span class="n">aVelocity</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'>    <span class="n">acceleration</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><div class="example">
  <a id="chapter03_exercise2" style="display: block;"></a><h4 id="exercise-32">Exercise 3.2</h4><p>Step 1:  Create a simulation where objects are shot out of a cannon.  Each object should experience a sudden force when shot (just once) as well as gravity (always present).</p>
<p>Step 2:  Add rotation to the object to model its spin as it is shot from the cannon.  How realistic can you make it look?</p>

</div></section><section><a id="chapter03_section3" style="display: block;"></a><h3 id="33-trigonometry">3.3 Trigonometry</h3><p><a id="sohcahtoa-823db130-253f-0130-bb15-7cd1c3f718ad" style="display: block;"></a><a id="trigonometry-823dc1d0-253f-0130-bb16-7cd1c3f718ad" style="display: block;"></a><a id="trigonometrysohcahtoa-823dd230-253f-0130-bb17-7cd1c3f718ad" style="display: block;"></a></p>
<p>I think it may be time.  We’ve looked at angles, we’ve spun an object.  It’s time for: <em>sohcahtoa</em>.  Yes, <em>sohcahtoa</em>.  This seemingly nonsensical word is actually the foundation for a lot of computer graphics work.    A basic understanding of trigonometry is essential if you want to calculate an angle, figure out the distance between points, work with circles, arcs, or lines.  And <em>sohcahtoa</em> is a  mnemonic device (albeit a somewhat absurd one) for what the trigonometric functions sine, cosine, and tangent mean.</p>
<a id="chapter03_figure4" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_04.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.4</p>
</div>
<div class="list">
	
	<ul>
		
			<li><p><strong><em>soh</em></strong>: sine  = opposite / hypotenuse
</p>
</li>
		
			<li><p><strong><em>cah</em></strong>: cosine  = adjacent / hypotenuse
</p>
</li>
		
			<li><p><strong><em>toa</em></strong>: tangent  = opposite / adjacent
</p>
</li>
		
	</ul>
</div><a id="chapter03_figure5" style="display: block;"></a><div class="image-container half-width-right" >
	
	<img src="/book/imgs/chapter03/ch03_05.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.5</p>
</div>
<p>Take a look at Figure 3.4 again.  There’s no need to memorize it, but make sure you feel comfortable with it.  Draw it again yourself.    Now let’s draw it a slightly different way (Figure 3.5).</p>
<p><a id="vectorsas-right-triangles-823e3ea0-253f-0130-bb18-7cd1c3f718ad" style="display: block;"></a></p>
<p>See how we create a right triangle out of a vector?  The vector arrow itself is the hypotenuse and the components of the vector (<span class="var">x</span> and <span class="var">y</span>) are the sides of the triangle.  The angle is an additional means for specifying the vector’s direction (or “heading”).</p>
<p>Because the trigonometric functions allow us to establish a relationship between the components of a vector and its direction + magnitude, they will prove very useful throughout this book.  We’ll begin by looking at an example that requires the tangent function.</p>
</section><section><a id="chapter03_section4" style="display: block;"></a><h3 id="34-pointing-in-the-direction-of-movement">3.4 Pointing in the Direction of Movement</h3><p><a id="rotationpointing-towards-movement-823e7540-253f-0130-bb19-7cd1c3f718ad" style="display: block;"></a></p>
<p>Let’s go all the way back to Example 1.10, which features a <span class="klass">Mover</span> object accelerating towards the mouse.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter01/_1_10_motion101_acceleration/_1_10_motion101_acceleration.pde /book/processingjs/chapter01/_1_10_motion101_acceleration/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p>You might notice that almost all of the shapes we’ve been drawing so far are circles.   This is convenient for a number of reasons, one of which is that we don’t have to consider the question of rotation.  Rotate a circle and, well, it looks exactly the same.  However, there comes a time in all motion programmers’ lives when they want to draw something on the screen that points in the direction of movement. Perhaps you are drawing an ant, or a car, or a spaceship. And when we say "point in the direction of movement," what we are really saying is “rotate according to the velocity vector.”  Velocity is a vector, with an <span class="var">x</span> and a <span class="var">y</span> component, but to rotate in Processing we need an angle, in radians.   Let’s draw our trigonometry diagram one more time, with an object’s velocity vector (Figure 3.6).</p>
<a id="chapter03_figure6" style="display: block;"></a><div class="image-container half-width-right" >
	
	<img src="/book/imgs/chapter03/ch03_06.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.6</p>
</div>
<p><a id="tangent-823ebdb0-253f-0130-bb1a-7cd1c3f718ad" style="display: block;"></a><a id="trigonometrytangent-823eccb0-253f-0130-bb1b-7cd1c3f718ad" style="display: block;"></a><a id="vectorstangent-823ee190-253f-0130-bb1c-7cd1c3f718ad" style="display: block;"></a></p>
<p>OK. We know that the definition of tangent is:</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle displaystyle="true"><mi> t </mi><mi> a </mi><mi> n </mi><mi> g </mi><mi> e </mi><mi> n </mi><mi> t </mi><mfenced><mrow><mi> a </mi><mi> n </mi><mi> g </mi><mi> l </mi><mi> e </mi></mrow></mfenced><mo> = </mo><mfrac><msub><mrow><mi> v </mi><mi> e </mi><mi> l </mi><mi> o </mi><mi> c </mi><mi> i </mi><mi> t </mi><mi> y </mi></mrow><mrow><mi> y </mi></mrow></msub> <msub><mrow><mi> v </mi><mi> e </mi><mi> l </mi><mi> o </mi><mi> c </mi><mi> i </mi><mi> t </mi><mi> y </mi></mrow><mrow><mi> x </mi></mrow></msub> </mfrac></mstyle></math></p>
<p>The problem with the above is that we know velocity, but we don’t know the angle.  We have to solve for the angle.   This is where a special function known as <em>inverse tangent</em> comes in, sometimes referred to as <em>arctangent</em> or <em>tan<sup>-1</sup></em>.  (There is also an <em>inverse sine</em> and an <em>inverse cosine</em>.)</p>
<p>If the tangent of some value <span class="var">a</span> equals some value <span class="var">b</span>, then the inverse tangent of <span class="var">b</span> equals <span class="var">a</span>. For example:</p>
<div class="list">
	
	<dl >
		
			<dt><em>if</em></dt>
			<dd><p><em>tangent(a) = b</em></p>
</dd>
		
			<dt><em>then</em></dt>
			<dd><p><em>a = arctangent(b)</em></p>
</dd>
		
	</dl>
</div><p>See how that is the inverse?   The above now allows us to solve for the angle:</p>
<div class="list">
	
	<dl >
		
			<dt><em>if</em></dt>
			<dd><p><em>tangent(angle) = velocity<sub>y</sub> / velocity<sub>x</sub></em></p>
</dd>
		
			<dt><em>then</em></dt>
			<dd><p><em>angle = arctangent(velocity<sub>y</sub> / velocity<sub>x</sub>)</em></p>
</dd>
		
	</dl>
</div><p><a id="atan-function-processing-823fc080-253f-0130-bb1d-7cd1c3f718ad" style="display: block;"></a><a id="processingatan-function-823fd170-253f-0130-bb1e-7cd1c3f718ad" style="display: block;"></a><a id="tangentatan-function-arctangent-823fe580-253f-0130-bb1f-7cd1c3f718ad" style="display: block;"></a><a id="trigonometryatan-function-823ffd20-253f-0130-bb20-7cd1c3f718ad" style="display: block;"></a></p>
<p>Now that we have the formula, let’s see where it should go in our mover’s <span class="function">display()</span> function.   Notice that in Processing, the function for arctangent is called <span class="function">atan()</span>.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  void display() {
    // Solve for angle by using atan().
    float angle = atan(velocity.y/velocity.x);

    stroke(0);
    fill(175);
    pushMatrix();
    rectMode(CENTER);
    translate(location.x,location.y);
    // Rotate according to that angle.
    rotate(angle);
    rect(0,0,30,10);
    popMatrix();
  }</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Solve for angle by using atan().</div><code><pre><span class='one-line'>    <span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">atan</span><span class="o">(</span><span class="n">velocity</span><span class="o">.</span><span class="na">y</span><span class="o">/</span><span class="n">velocity</span><span class="o">.</span><span class="na">x</span><span class="o">);</span></span>
<span class='one-line'> </span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">pushMatrix</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">rectMode</span><span class="o">(</span><span class="n">CENTER</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">translate</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Rotate according to that angle.</div><code><pre><span class='one-line'>    <span class="n">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">30</span><span class="o">,</span><span class="mi">10</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">popMatrix</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Now the above code is pretty darn close, and almost works.   We still have a big problem, though.  Let’s consider the two velocity vectors depicted below.</p>
<a id="chapter03_figure7" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_07.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.7</p>
</div>
<p>Though superficially similar, the two vectors point in quite different directions—opposite  directions, in fact!  However, if we were to apply our formula to solve for the angle to each vector…</p>
<p><span class="formula">V1 ⇒ angle = atan(-4/3) = atan(-1.25) = -0.9272952 radians = -53 degrees</span><br /><span class="formula">V2 ⇒ angle = atan(4/-3) = atan(-1.25) = -0.9272952 radians = -53 degrees</span></p>
<p><a id="atan2-function-processing-824045b0-253f-0130-bb21-7cd1c3f718ad" style="display: block;"></a><a id="processingatan2-function-824055e0-253f-0130-bb22-7cd1c3f718ad" style="display: block;"></a><a id="tangentatan2-function-824067a0-253f-0130-bb23-7cd1c3f718ad" style="display: block;"></a></p>
<p>…we get the same angle for each vector.   This can’t be right for both; the vectors point in opposite directions!   The thing is, this is a pretty common problem in computer graphics. Rather than simply using <span class="function">atan()</span> along with a bunch of conditional statements to account for positive/negative scenarios, Processing (along with pretty much all programming environments) has a nice function called <span class="function">atan2()</span> that does it for you.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_03_pointing_velocity/_3_03_pointing_velocity.pde /book/processingjs/chapter03/_3_03_pointing_velocity/Mover.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example3" style="display: block;"></a><span class="example">Example 3.3: Pointing in the direction of motion</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  void display() {
    // Using atan2() to account for all possible directions
    float angle = atan2(velocity.y,velocity.x);

    stroke(0);
    fill(175);
    pushMatrix();
    rectMode(CENTER);
    translate(location.x,location.y);
    // Rotate according to that angle.
    rotate(angle);
    rect(0,0,30,10);
    popMatrix();
  }</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Using atan2() to account for all possible directions</div><code><pre><span class='one-line'>    <span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">atan2</span><span class="o">(</span><span class="n">velocity</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="n">velocity</span><span class="o">.</span><span class="na">x</span><span class="o">);</span></span>
<span class='one-line'> </span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">pushMatrix</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">rectMode</span><span class="o">(</span><span class="n">CENTER</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">translate</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Rotate according to that angle.</div><code><pre><span class='one-line'>    <span class="n">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">rect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">30</span><span class="o">,</span><span class="mi">10</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">popMatrix</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="heading-function-pvector-class-82409cf0-253f-0130-bb24-7cd1c3f718ad" style="display: block;"></a><a id="motionheading-function-pvector-class-8240adb0-253f-0130-bb25-7cd1c3f718ad" style="display: block;"></a><a id="pvector-class-processingheading-function-8240cae0-253f-0130-bb26-7cd1c3f718ad" style="display: block;"></a><a id="tangentheading-function-pvector-class-8240dd70-253f-0130-bb27-7cd1c3f718ad" style="display: block;"></a></p>
<p>To simplify this even further, the <span class="klass">PVector</span> class itself provides a function called <span class="klass">heading()</span>, which takes care of calling <span class="function">atan2()</span> for you so you can get the 2D direction angle, in radians, for any Processing <span class="klass">PVector</span>.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>    // The easiest way to do this!
    float angle = velocity.heading();</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair '><div class='code-comment '>The easiest way to do this!</div><code><pre><span class='one-line'>    <span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="na">heading</span><span class="o">();</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><div class="example">
  <a id="chapter03_exercise3" style="display: block;"></a><h4 id="exercise-33">Exercise 3.3</h4><p>Create a simulation of a vehicle that you can drive around the screen using the arrow keys: left arrow accelerates the car to the left, right to the right.  The car should point in the direction in which it is currently moving.</p>

</div></section><section><a id="chapter03_section5" style="display: block;"></a><h3 id="35-polar-vs-cartesian-coordinates">3.5 Polar vs. Cartesian Coordinates</h3><p><a id="cartesian-coordinates-82411ea0-253f-0130-bb28-7cd1c3f718ad" style="display: block;"></a><a id="coordinate-systems-82412cf0-253f-0130-bb29-7cd1c3f718ad" style="display: block;"></a><a id="coordinate-systemscartesian-82413d40-253f-0130-bb2a-7cd1c3f718ad" style="display: block;"></a><a id="descartes-ren-82414dd0-253f-0130-bb2b-7cd1c3f718ad" style="display: block;"></a><a id="shapesdisplaying-82415e30-253f-0130-bb2c-7cd1c3f718ad" style="display: block;"></a></p>
<p>Any time we display a shape in Processing, we have to specify a pixel location, a set of <span class="var">x</span> and <span class="var">y</span> coordinates.  These coordinates are known as <strong><em>Cartesian coordinates</em></strong>, named for René Descartes, the French mathematician who developed the ideas behind Cartesian space.</p>
<p><a id="coordinate-systemspolar-8241a160-253f-0130-bb2d-7cd1c3f718ad" style="display: block;"></a><a id="polar-coordinates-8241b120-253f-0130-bb2e-7cd1c3f718ad" style="display: block;"></a></p>
<p>Another useful coordinate system known as <strong><em>polar coordinates</em></strong> describes a point in space as an angle of rotation around the origin and a radius from the origin.   Thinking about this in terms of a vector:</p>
<p>Cartesian coordinate—the <em>x</em>,<em>y</em> components of a vector<br />
Polar coordinate—the magnitude (length) and direction (angle) of a vector</p>
<p><a id="coordinate-systemsprocessing-and-8241db40-253f-0130-bb2f-7cd1c3f718ad" style="display: block;"></a><a id="processingcoordinate-systems-and-8241ecf0-253f-0130-bb30-7cd1c3f718ad" style="display: block;"></a></p>
<p>Processing’s drawing functions, however, don’t understand polar coordinates.  Whenever we want to display something in Processing, we have to specify locations as <em>(x,y)</em> Cartesian coordinates.   However, sometimes it is a great deal more convenient for us to think in polar coordinates when designing.   Happily for us, with trigonometry we can convert back and forth between polar and Cartesian, which allows us to design with whatever coordinate system we have in mind but always draw with Cartesian coordinates.</p>
<p><a id="theta--824207e0-253f-0130-bb31-7cd1c3f718ad" style="display: block;"></a><a id="anglestheta--82421660-253f-0130-bb32-7cd1c3f718ad" style="display: block;"></a></p>
<a id="chapter03_figure8" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_08.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.8: The Greek letter θ (theta) is often used to denote an angle.  Since a polar coordinate is conventionally referred to as (r, θ), we’ll use theta as a variable name when referring to an angle.</p>
</div>
<p><span class="formula">sine(theta)   = y/r   →   y = r * sine(theta)</span><br /><span class="formula">cosine(theta) = x/r   →   x = r * cosine(theta)</span></p>
<p><a id="cartesian-coordinatespolar-coordinates-converting-from-82424670-253f-0130-bb33-7cd1c3f718ad" style="display: block;"></a><a id="cos-function-processing-82425770-253f-0130-bb34-7cd1c3f718ad" style="display: block;"></a><a id="polar-coordinatescartesian-coordinates-converting-to-82426910-253f-0130-bb35-7cd1c3f718ad" style="display: block;"></a><a id="sin-function-processing-824283d0-253f-0130-bb36-7cd1c3f718ad" style="display: block;"></a><a id="trigonometrycos-function-processing-824295c0-253f-0130-bb37-7cd1c3f718ad" style="display: block;"></a><a id="trigonometrysin-function-processing-8242a920-253f-0130-bb38-7cd1c3f718ad" style="display: block;"></a></p>
<p>For example, if <span class="var">r</span> is 75 and <span class="var">theta</span> is 45 degrees (or PI/4 radians), we can calculate <span class="var">x</span> and <span class="var">y</span> as below.  The functions for sine and cosine in Processing are <span class="function">sin()</span> and <span class="function">cos()</span>, respectively.  They each take one argument, an angle measured in radians.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float r = 75;
float theta = PI / 4;
//[full] Converting from polar (r,theta) to Cartesian (x,y)
float x = r * cos(theta);
float y = r * sin(theta);
//[end]</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">75</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">PI</span> <span class="o">/</span> <span class="mi">4</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Converting from polar (r,theta) to Cartesian (x,y)</div><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cos</span><span class="o">(</span><span class="n">theta</span><span class="o">);</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="o">(</span><span class="n">theta</span><span class="o">);</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="shapesmoving-with-polar-coordinates-8242f6c0-253f-0130-bb39-7cd1c3f718ad" style="display: block;"></a></p>
<p>This type of conversion can be useful in certain applications.  For example, to move a shape along a circular path using Cartesian coordinates is not so easy.  With polar coordinates, on the other hand, it’s simple: increment the angle!</p>
<p>Here’s how it is done with global variables <span class="var">r</span> and <span class="var">theta</span>.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_04_PolarToCartesian/_3_04_PolarToCartesian.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example4" style="display: block;"></a><span class="example">Example 3.4: Polar to Cartesian</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float r = 75;
float theta = 0;

void setup() {
  size(640,360);
  background(255);
}

void draw() {

  //[full] Polar coordinates (r,theta) are converted to Cartesian (x,y) for use in the ellipse() function.
  float x = r * cos(theta);
  float y = r * sin(theta);
  //[end]

  noStroke();
  fill(0);
  ellipse(x+width/2, y+height/2, 16, 16);

  theta += 0.01;
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">75</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">640</span><span class="o">,</span><span class="mi">360</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Polar coordinates (r,theta) are converted to Cartesian (x,y) for use in the ellipse() function.</div><code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cos</span><span class="o">(</span><span class="n">theta</span><span class="o">);</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="o">(</span><span class="n">theta</span><span class="o">);</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span>
<span class='one-line'>  <span class="n">noStroke</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">fill</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">ellipse</span><span class="o">(</span><span class="n">x</span><span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">y</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">16</span><span class="o">);</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="n">theta</span> <span class="o">+=</span> <span class="mf">0.01</span><span class="o">;</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><div class="example">
  <a id="chapter03_exercise4" style="display: block;"></a><h4 id="exercise-34">Exercise 3.4</h4><p>Using Example 3.4 as a basis, draw a spiral path.  Start in the center and move outwards.  Note that this can be done by only changing one line of code and adding one line of code!</p>
<div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_exc04.png" alt="Nature of Code Image" />
	
	
</div>

</div><div class="example">
  <a id="chapter03_exercise5" style="display: block;"></a><h4 id="exercise-35">Exercise 3.5</h4><p>Simulate the spaceship in the game Asteroids.   In case you aren’t familiar with Asteroids, here is a brief description: A spaceship (represented as a triangle) floats in two dimensional space.   The left arrow key turns the spaceship counterclockwise, the right arrow key, clockwise.  The <em>z</em> key applies a “thrust” force in the direction the spaceship is pointing.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/Ex_3_05_asteroids/Ex_3_05_asteroids.pde /book/processingjs/chapter03/Ex_3_05_asteroids/Spaceship.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>

</div></section><section><a id="chapter03_section6" style="display: block;"></a><h3 id="36-oscillation-amplitude-and-period">3.6 Oscillation Amplitude and Period</h3><p><a id="oscillation-82436ec0-253f-0130-bb3a-7cd1c3f718ad" style="display: block;"></a></p>
<p>Are you amazed yet?  We’ve seen some pretty great uses of tangent (for finding the angle of a vector) and sine and cosine (for converting from polar to Cartesian coordinates).   We could stop right here and be satisfied.  But we’re not going to.  This is only the beginning.  What sine and cosine can do for you goes beyond mathematical formulas and right triangles.</p>
<p>Let’s take a look at a graph of the sine function, where <em>y = sine(x)</em>.</p>
<a id="chapter03_figure9" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_09.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.9: y = sine(x)</p>
</div>
<p>You’ll notice that the output of the sine function is a smooth curve alternating between –1 and 1.  This type of a behavior is known as <strong><em>oscillation</em></strong>, a periodic movement between two points.  Plucking a guitar string, swinging a pendulum, bouncing on a pogo stick—these are all examples of oscillating motion.</p>
<p><a id="oscillationsimulating-with-sine-curves-82439e90-253f-0130-bb3b-7cd1c3f718ad" style="display: block;"></a></p>
<p>And so we happily discover that we can simulate oscillation in a Processing sketch by assigning the output of the sine function to an object’s location.  Note that this will follow the same methodology we applied to Perlin noise in the <a href="#intro_section6">Introduction</a>.</p>
<p>Let’s begin with a really basic scenario.  We want a circle to oscillate from the left side to the right side of a Processing window.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_05_simple_harmonic_motion/_3_05_simple_harmonic_motion.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="oscillationsimple-harmonic-motion-8243c150-253f-0130-bb3c-7cd1c3f718ad" style="display: block;"></a><a id="simple-harmonic-motion-8243d180-253f-0130-bb3d-7cd1c3f718ad" style="display: block;"></a></p>
<p>This is what is known as <strong><em>simple harmonic motion</em></strong> (or, to be fancier, “the periodic sinusoidal oscillation of an object”).   It’s going to be a simple program to write, but before we get into the code, let’s familiarize ourselves with some of the terminology of oscillation (and waves).</p>
<p>Simple harmonic motion can be expressed as any location (in our case, the <span class="var">x</span> location) as a function of time, with the following two elements:</p>
<p><a id="amplitude-8243f6d0-253f-0130-bb3e-7cd1c3f718ad" style="display: block;"></a><a id="oscillationamplitude-82440750-253f-0130-bb3f-7cd1c3f718ad" style="display: block;"></a><a id="oscillationperiod-82442040-253f-0130-bb40-7cd1c3f718ad" style="display: block;"></a><a id="period-824433e0-253f-0130-bb41-7cd1c3f718ad" style="display: block;"></a></p>
<div class="list">
	
	<ul>
		
			<li><p><strong><em>Amplitude</em></strong>: The distance from the center of motion to either extreme<br /></p>
</li>
		
			<li><p><strong><em>Period</em></strong>: The amount of time it takes for one complete cycle of motion
</p>
</li>
		
	</ul>
</div><p>Looking at the graph of sine (Figure 3.9), we can see that the amplitude is 1 and the period is <span class="var">TWO_PI</span>; the output of sine never rises above 1 or below -1; and every <span class="var">TWO_PI</span> radians (or 360 degrees) the wave pattern repeats.</p>
<p>Now, in the Processing world we live in, what is amplitude and what is period?  Amplitude can be measured rather easily in pixels.   In the case of a window 200 pixels wide, we would oscillate from the center 100 pixels to the right and 100 pixels to the left. Therefore:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>// Our amplitude is measured in pixels.
float amplitude = 100;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair '><div class='code-comment '>Our amplitude is measured in pixels.</div><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="millis-function-processing-82447580-253f-0130-bb42-7cd1c3f718ad" style="display: block;"></a><a id="processingmeasuring-time-in-82448ce0-253f-0130-bb43-7cd1c3f718ad" style="display: block;"></a><a id="timemillis-function-measuring-with-8244a010-253f-0130-bb44-7cd1c3f718ad" style="display: block;"></a><a id="period-8244b140-253f-0130-bb45-7cd1c3f718ad" style="display: block;"></a></p>
<p><em>Period</em> is the amount of time it takes for one cycle, but what is time in our Processing world?  I mean, certainly we could say we want the circle to oscillate every three seconds.  And we could track the milliseconds—using <span class="function">millis()</span> —in Processing and come up with an elaborate algorithm for oscillating an object according to real-world time.   But for us, real-world time doesn’t really matter. The real measure of time in Processing is in frames.  The oscillating motion should repeat every 30 frames, or 50 frames, or 1000 frames, etc.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>// Our period is measured in frames (our unit of time for animation).
float period = 120;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair '><div class='code-comment '>Our period is measured in frames (our unit of time for animation).</div><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">120</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Once we have the amplitude and period, it’s time to write a formula to calculate x as a function of time, which we now know is the current frame count.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float x = amplitude * cos(TWO_PI * frameCount / period);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">cos</span><span class="o">(</span><span class="n">TWO_PI</span> <span class="o">*</span> <span class="n">frameCount</span> <span class="o">/</span> <span class="n">period</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="map-function-processingoscillation-and-8244d480-253f-0130-bb46-7cd1c3f718ad" style="display: block;"></a></p>
<p>Let’s dissect the formula a bit more and try to understand each component.   The first is probably the easiest.   Whatever comes out of the cosine function we multiply by amplitude.   We know that cosine will oscillate between -1 and 1. If we take that value and multiply it by amplitude then we’ll get the desired result: a value oscillating between -amplitude and amplitude.   (Note: this is also a place where we could use Processing’s <span class="function">map()</span> function to map the output of cosine to a custom range.)</p>
<p>Now, let’s look at what is inside the cosine function:</p>
<p><span class="formula">TWO_PI * frameCount / period</span></p>
<p>What’s going on here?   Let’s start with what we know.  We know that cosine will repeat every 2*PI radians—i.e. it will start at 0 and repeat at 2*PI, 4*PI, 6*PI, etc.   If the period is 120, then we want the oscillating motion to repeat when the <span class="var">frameCount</span> is at 120 frames, 240 frames, 360 frames, etc.  <span class="var">frameCount</span> is really the only variable; it starts at 0 and counts upward.   Let’s take a look at what the formula yields with those values.</p>
<div class="table">
	
	<table>
		
			<thead>
				<tr>
					
						<th>frameCount </th>
					
						<th>frameCount / period  </th>
					
						<th>TWO_PI * frameCount / period</th>
					
				</tr>
			</thead>
		
	
		
	
		<tbody>
		
			<tr>
				
					<td><p>0</p>
</td>
				
					<td><p>0</p>
</td>
				
					<td><p>0</p>
</td>
				
			</tr>
		
			<tr>
				
					<td><p>60</p>
</td>
				
					<td><p>0.5</p>
</td>
				
					<td><p>PI</p>
</td>
				
			</tr>
		
			<tr>
				
					<td><p>120</p>
</td>
				
					<td><p>1</p>
</td>
				
					<td><p>TWO_PI</p>
</td>
				
			</tr>
		
			<tr>
				
					<td><p>240</p>
</td>
				
					<td><p>2</p>
</td>
				
					<td><p>2 * TWO_PI (or 4* PI)</p>
</td>
				
			</tr>
		
			<tr>
				
					<td><p>etc.</p>
</td>
				
					<td><p></p>
</td>
				
					<td><p></p>
</td>
				
			</tr>
		
		</tbody>
	</table>
</div><p><span class="var">frameCount</span> divided by <span class="var">period</span> tells us how many cycles we’ve completed—are we halfway through the first cycle?  Have we completed two  cycles?  By multiplying that number by <span class="var">TWO_PI</span>, we get the result we want, since <span class="var">TWO_PI</span> is the number of radians required for one cosine (or sine) to complete one cycle.</p>
<p>Wrapping this all up, here’s the Processing example that oscillates the <span class="var">x</span> location of a circle with an amplitude of 100 pixels and a period of 120 frames.</p>
<p><a id="chapter03_example5" style="display: block;"></a><span class="example">Example 3.5: Simple Harmonic Motion</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>void setup() {
  size(640,360);
}

void draw() {
  background(255);

  float period = 120;
  float amplitude = 100;
  //[offset-down] Calculating horizontal location according to the formula for simple harmonic motion
  float x = amplitude * cos(TWO_PI * frameCount / period);
  stroke(0);
  fill(175);
  translate(width/2,height/2);
  line(0,0,x,0);
  ellipse(x,0,20,20);
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">640</span><span class="o">,</span><span class="mi">360</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">120</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair offset-down'><div class='code-comment '> Calculating horizontal location according to the formula for simple harmonic motion</div><code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">cos</span><span class="o">(</span><span class="n">TWO_PI</span> <span class="o">*</span> <span class="n">frameCount</span> <span class="o">/</span> <span class="n">period</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">translate</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">line</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">x</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">ellipse</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">20</span><span class="o">,</span><span class="mi">20</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="frequency-of-oscillations-824597f0-253f-0130-bb47-7cd1c3f718ad" style="display: block;"></a><a id="oscillationfrequency-of-8245ab80-253f-0130-bb48-7cd1c3f718ad" style="display: block;"></a></p>
<p>It’s also worth mentioning the term <strong><em>frequency</em></strong>: the number of cycles per time unit.  Frequency is equal to 1 divided by <span class="var">period</span>.  If the period is 120 frames, then only 1/120th of a cycle is completed in one frame, and so frequency = 1/120.   In the above example, we simply chose to define the rate of oscillation in terms of period and therefore did not need a variable for frequency.</p>
<div class="example">
  <a id="chapter03_exercise6" style="display: block;"></a><h4 id="exercise-36">Exercise 3.6</h4><p>Using the sine function, create a simulation of a weight (sometimes referred to as a “bob”) that hangs from a spring from the top of the window.  Use the <span class="function">map()</span> function to calculate the vertical location of the bob.  Later in this chapter, we’ll see how to recreate this same simulation by modeling the forces of a spring according to Hooke’s law.</p>

</div></section><section><a id="chapter03_section7" style="display: block;"></a><h3 id="37-oscillation-with-angular-velocity">3.7 Oscillation with Angular Velocity</h3><p><a id="angular-velocity-oscillation-with-82460da0-253f-0130-bb49-7cd1c3f718ad" style="display: block;"></a><a id="oscillationangular-velocity-and-82462720-253f-0130-bb4a-7cd1c3f718ad" style="display: block;"></a></p>
<p>An understanding of the concepts of oscillation, amplitude, and frequency/period is often required in the course of simulating real-world behaviors.  However, there is a slightly easier way to rewrite the above example with the same result.  Let’s take one more look at our oscillation formula:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float x = amplitude * cos(TWO_PI * frameCount / period);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">cos</span><span class="o">(</span><span class="n">TWO_PI</span> <span class="o">*</span> <span class="n">frameCount</span> <span class="o">/</span> <span class="n">period</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>And let’s rewrite it a slightly different way:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float x = amplitude * cos ( some value that increments slowly );</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">cos</span> <span class="o">(</span> <span class="n">some</span> <span class="n">value</span> <span class="n">that</span> <span class="n">increments</span> <span class="n">slowly</span> <span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>If we care about precisely defining the period of oscillation in terms of frames of animation, we might need the formula the way we first wrote it, but we can just as easily rewrite our example using the concept of angular velocity (and acceleration) from <a href="#chapter03_section2">section 3.2</a>.  Assuming:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float angle = 0;
float aVelocity = 0.05;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">aVelocity</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>in <span class="function">draw()</span>, we can simply say:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>angle += aVelocity;
float x = amplitude * cos(angle);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">angle</span> <span class="o">+=</span> <span class="n">aVelocity</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">cos</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><span class="var">angle</span> is our “some value that increments slowly.”</p>
<p><a id="chapter03_example6" style="display: block;"></a><span class="example">Example 3.6: Simple Harmonic Motion II</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float angle = 0;
float aVelocity = 0.05;

void setup() {
  size(640,360);
}

void draw() {
  background(255);

  float amplitude = 100;
  float x = amplitude * cos(angle);
  // Using the concept of angular velocity to increment an angle variable
  angle += aVelocity;

  ellipseMode(CENTER);
  stroke(0);
  fill(175);
  translate(width/2,height/2);
  line(0,0,x,0);
  ellipse(x,0,20,20);
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">aVelocity</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">640</span><span class="o">,</span><span class="mi">360</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">cos</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Using the concept of angular velocity to increment an angle variable</div><code><pre><span class='one-line'>  <span class="n">angle</span> <span class="o">+=</span> <span class="n">aVelocity</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="n">ellipseMode</span><span class="o">(</span><span class="n">CENTER</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">translate</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">line</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">x</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">ellipse</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">20</span><span class="o">,</span><span class="mi">20</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Just because we’re not referencing it directly doesn’t mean that we’ve eliminated the concept of <span class="var">period</span>.  After all, the greater the angular velocity, the faster the circle will oscillate (therefore lowering the period).   In fact, the number of times it takes to add up the angular velocity to get to <span class="var">TWO_PI</span> is the period or:</p>
<p><span class="formula">period = TWO_PI / angular velocity</span></p>
<p><a id="oscillationon-two-axes-8246b750-253f-0130-bb4b-7cd1c3f718ad" style="display: block;"></a></p>
<p>Let’s expand this example a bit more and create an <span class="klass">Oscillator</span> class.  And let’s assume we want the oscillation to happen along both the x-axis (as above) and the y-axis.  To do this, we’ll need two angles, two angular velocities, and two amplitudes (one for each axis).   Another perfect opportunity for <span class="klass">PVector</span>!</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_07_oscillating_objects/_3_07_oscillating_objects.pde /book/processingjs/chapter03/_3_07_oscillating_objects/Oscillator.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example7" style="display: block;"></a><span class="example">Example 3.7: Oscillator objects</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>class Oscillator  {

  // Using a PVector to track two angles!
  PVector angle;
  PVector velocity;
  PVector amplitude;

  Oscillator()  {
    angle = new PVector();
    velocity = new PVector(random(-0.05,0.05),random(-0.05,0.05));
    //[offset-down] Random velocities and amplitudes
    amplitude = new PVector(random(width/2),random(height/2));
  }

  void oscillate()  {
    angle.add(velocity);
  }

  void display()  {
    // Oscillating on the x-axis
    float x = sin(angle.x)*amplitude.x;
    // Oscillating on the y-axis
    float y = sin(angle.y)*amplitude.y;

    pushMatrix();
    translate(width/2,height/2);
    stroke(0);
    fill(175);
    // Drawing the Oscillator as a line connecting a circle
    line(0,0,x,y);
    ellipse(x,y,16,16);
    popMatrix();
  }
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Oscillator</span>  <span class="o">{</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Using a PVector to track two angles!</div><code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">angle</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">velocity</span><span class="o">;</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">amplitude</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="n">Oscillator</span><span class="o">()</span>  <span class="o">{</span></span>
<span class='one-line'>    <span class="n">angle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">velocity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">random</span><span class="o">(-</span><span class="mf">0.05</span><span class="o">,</span><span class="mf">0.05</span><span class="o">),</span><span class="n">random</span><span class="o">(-</span><span class="mf">0.05</span><span class="o">,</span><span class="mf">0.05</span><span class="o">));</span></span></pre></code></div>

  <div class='code-comment-pair offset-down'><div class='code-comment '> Random velocities and amplitudes</div><code><pre><span class='one-line'>    <span class="n">amplitude</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">random</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">),</span><span class="n">random</span><span class="o">(</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">));</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="kt">void</span> <span class="nf">oscillate</span><span class="o">()</span>  <span class="o">{</span></span>
<span class='one-line'>    <span class="n">angle</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">velocity</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span>  <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Oscillating on the x-axis</div><code><pre><span class='one-line'>    <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">.</span><span class="na">x</span><span class="o">)*</span><span class="n">amplitude</span><span class="o">.</span><span class="na">x</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Oscillating on the y-axis</div><code><pre><span class='one-line'>    <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">.</span><span class="na">y</span><span class="o">)*</span><span class="n">amplitude</span><span class="o">.</span><span class="na">y</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'>    <span class="n">pushMatrix</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">translate</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Drawing the Oscillator as a line connecting a circle</div><code><pre><span class='one-line'>    <span class="n">line</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">ellipse</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">,</span><span class="mi">16</span><span class="o">,</span><span class="mi">16</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">popMatrix</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><div class="example">
  <a id="chapter03_exercise7" style="display: block;"></a><h4 id="exercise-37">Exercise 3.7</h4><p>Try initializing each <span class="klass">Oscillator</span> object with velocities and amplitudes that are not random to create some sort of regular pattern.  Can you make the oscillators appear to be the legs of a insect-like creature?</p>

</div><div class="example">
  <a id="chapter03_exercise8" style="display: block;"></a><h4 id="exercise-38">Exercise 3.8</h4><p>Incorporate angular acceleration into the <span class="klass">Oscillator</span> object.</p>

</div></section><section><a id="chapter03_section8" style="display: block;"></a><h3 id="38-waves">3.8 Waves</h3><p><a id="oscillationwaves-8248d6e0-253f-0130-bb4c-7cd1c3f718ad" style="display: block;"></a><a id="waves-8248efc0-253f-0130-bb4d-7cd1c3f718ad" style="display: block;"></a></p>
<p>If you’re saying to yourself, “Um, this is all great and everything, but what I really want is to draw a wave onscreen,” well, then, the time has come.   The thing is, we’re about 90% there.  When we oscillate a single circle up and down according to the sine function, what we are doing is looking at a single point along the x-axis of a wave pattern.  With a little panache and a <span class="function">for</span> loop, we can place a whole bunch of these oscillating circles next to each other.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_09_wave/_3_09_wave.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p>This wavy pattern could be used in the design of the body or appendages of a creature, as well as to simulate a soft surface (such as water).</p>
<p><a id="perioddefined-in-pixels-rather-than-frames-82491b10-253f-0130-bb4e-7cd1c3f718ad" style="display: block;"></a><a id="wavesangular-velocity-defining-with-82492fa0-253f-0130-bb4f-7cd1c3f718ad" style="display: block;"></a></p>
<p>Here, we’re going to encounter the same questions of amplitude (height of pattern) and period.  Instead of period referring to time, however, since we’re looking at the full wave, we can talk about period as the width (in pixels) of a full wave cycle.    And just as with simple oscillation, we have the option of computing the wave pattern according to a precise period or simply following the model of angular velocity.</p>
<p>Let’s go with the simpler case, angular velocity.   We know we need to start with an angle, an angular velocity, and an amplitude:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float angle = 0;
float angleVel = 0.2;
float amplitude = 100;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">angleVel</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Then we’re going to loop through all of the <span class="var">x</span> values where we want to draw a point of the wave.  Let’s say every 24 pixels for now.  In that loop, we’re going to want to do three things:</p>
<div class="list">
	
	<ol class="arabic">
		
			<li><p>
Calculate the y location according to amplitude and sine of the angle.
</p>
</li>
		
			<li><p>
Draw a circle at the <em>(x,y)</em> location.
</p>
</li>
		
			<li><p>
Increment the angle according to angular velocity.
</p>
</li>
		
	</ol>
</div><div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  for (int x = 0; x <= width; x += 24) {

    // 1) Calculate the y location according to
    // amplitude and sine of the angle.
    float y = amplitude*sin(angle);

    // 2) Draw a circle at the (x,y) location.
    ellipse(x,y+height/2,48,48);

    // 3) Increment the angle according to angular velocity.
    angle += angleVel;
  }</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">width</span><span class="o">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">24</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>1) Calculate the y location according to
amplitude and sine of the angle.</div><code><pre><span class='one-line'>    <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">amplitude</span><span class="o">*</span><span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>2) Draw a circle at the (x,y) location.</div><code><pre><span class='one-line'>    <span class="n">ellipse</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="mi">48</span><span class="o">,</span><span class="mi">48</span><span class="o">);</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>3) Increment the angle according to angular velocity.</div><code><pre><span class='one-line'>    <span class="n">angle</span> <span class="o">+=</span> <span class="n">angleVel</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Let’s look at the results with different values for <span class="var">angleVel</span>:</p>
<div class="image-container three-col" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_09_wave_a/_3_09_wave_a.pde" class="three-col">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	<p class="caption">angleVel = 0.05</p>
</div>
<div class="image-container three-col" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_09_wave_b/_3_09_wave_b.pde" class="three-col">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	<p class="caption">angleVel = 0.2</p>
</div>
<div class="image-container three-col" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_09_wave_c/_3_09_wave_c.pde" class="three-col">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	<p class="caption">angleVel = 0.4</p>
</div>
<p>Notice how, although we’re not precisely computing the period of the wave, the higher the angular velocity, the shorter the period.  It’s also worth noting that as the period becomes shorter, it becomes more and more difficult to make out the wave itself as the distance between the individual points increases.  One option we have is to use <span class="function">beginShape()</span> and <span class="function">endShape()</span> to connect the points with a line.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_08_static_wave_lines/_3_08_static_wave_lines.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example8" style="display: block;"></a><span class="example">Example 3.8: Static wave drawn as a continuous line</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float angle = 0;
float angleVel = 0.2;
float amplitude = 100;

size(400,200);
background(255);

stroke(0);
strokeWeight(2);
noFill();

beginShape();
for (int x = 0; x <= width; x += 5) {
  // Here’s an example of using the map() function
  // instead.
  float y = map(sin(angle),-1,1,0,height);
  // With beginShape() and endShape(), you call
  // vertex() to set all the vertices of your shape.
  vertex(x,y);
  angle +=angleVel;
}
endShape();</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">angleVel</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="n">size</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span><span class="mi">200</span><span class="o">);</span></span>
<span class='one-line'><span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'><span class="n">strokeWeight</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span></span>
<span class='one-line'><span class="n">noFill</span><span class="o">();</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="n">beginShape</span><span class="o">();</span></span>
<span class='one-line'><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">width</span><span class="o">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">5</span><span class="o">)</span> <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Here’s an example of using the map() function
instead.</div><code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">map</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">),-</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">height</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>With beginShape() and endShape(), you call
vertex() to set all the vertices of your shape.</div><code><pre><span class='one-line'>  <span class="n">vertex</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">angle</span> <span class="o">+=</span><span class="n">angleVel</span><span class="o">;</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'><span class="n">endShape</span><span class="o">();</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="oscillationvarying-8249b1d0-253f-0130-bb50-7cd1c3f718ad" style="display: block;"></a><a id="wavesvarying-8249c470-253f-0130-bb51-7cd1c3f718ad" style="display: block;"></a></p>
<p>You may have noticed that the above example is static.  The wave never changes, never undulates.   This additional step is a bit tricky.  Your first instinct might be to say: “Hey, no problem, we’ll just let theta be a global variable and let it increment from one cycle through <span class="function">draw()</span> to another.”</p>
<p>While it’s a nice thought, it doesn’t work.   If you look at the wave, the righthand edge doesn’t match the lefthand; where it ends in one cycle of <span class="function">draw()</span> can’t be where it starts in the next.  Instead, what we need to do is have a variable dedicated entirely to tracking what value of angle the wave should start with.   This angle (which we’ll call <span class="var">startAngle</span>) increments with its own angular velocity.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_09_wave/_3_09_wave.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example9" style="display: block;"></a><span class="example">Example 3.9: The Wave</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float startAngle = 0;
float angleVel = 0.1;

void setup() {
  size(400,200);
}

void draw() {
  background(255);

  //[full] In order to move the wave, we start at a different theta value each frame.  startAngle += 0.02;
float angle = startAngle;
  //[end]

  for (int x = 0; x <= width; x += 24) {
    float y = map(sin(angle),-1,1,0,height);
    stroke(0);
    fill(0,50);
    ellipse(x,y,48,48);
    angle += angleVel;
  }
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">startAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">angleVel</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span><span class="mi">200</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> In order to move the wave, we start at a different theta value each frame.  startAngle += 0.02;</div><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">startAngle</span><span class="o">;</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span>
<span class='one-line'>  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">width</span><span class="o">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">24</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">map</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">),-</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">height</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">50</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">ellipse</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">,</span><span class="mi">48</span><span class="o">,</span><span class="mi">48</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">angle</span> <span class="o">+=</span> <span class="n">angleVel</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><div class="example">
  <a id="chapter03_exercise9" style="display: block;"></a><h4 id="exercise-39">Exercise 3.9</h4><p>Try using the Perlin noise function instead of sine or cosine with the above example.</p>

</div><div class="example">
  <a id="chapter03_exercise10" style="display: block;"></a><h4 id="exercise-310">Exercise 3.10</h4><p>Encapsulate the above examples into a <span class="klass">Wave</span> class and create a sketch that displays two waves (with different amplitudes/periods) as in the screenshot below.  Move beyond plain circles and lines and try visualizing the wave in a more creative way.</p>
<div class="image-container " >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/Ex_3_10_OOPWave/Ex_3_10_OOPWave.pde /book/processingjs/chapter03/Ex_3_10_OOPWave/Wave.pde" >
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>

</div><div class="example">
  <a id="chapter03_exercise11" style="display: block;"></a><h4 id="exercise-311">Exercise 3.11</h4><p>More complex waves can be produced by the values of multiple waves together.  Create a sketch that implements this, as in the screenshot below.</p>
<div class="image-container " >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/Ex_3_11_AdditiveWave/Ex_3_11_AdditiveWave.pde" >
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>

</div></section><section><a id="chapter03_section9" style="display: block;"></a><h3 id="39-trigonometry-and-forces-the-pendulum">3.9 Trigonometry and Forces: The Pendulum</h3><p><a id="forcestrigonometry-and-824a3710-253f-0130-bb52-7cd1c3f718ad" style="display: block;"></a><a id="natural-phenomenapivots-modeling-824a49e0-253f-0130-bb53-7cd1c3f718ad" style="display: block;"></a><a id="pivots-modeling-824a5c70-253f-0130-bb54-7cd1c3f718ad" style="display: block;"></a><a id="trigonometryforces-and-824a7470-253f-0130-bb55-7cd1c3f718ad" style="display: block;"></a></p>
<p>Do you miss Newton’s laws of motion?  I know I sure do.  Well, lucky for you, it’s time to bring it all back home.  After all, it’s been nice learning about triangles and tangents and waves, but really, the core of this book is about simulating the physics of moving bodies.  Let’s take a look at how trigonometry can help us with this pursuit.</p>
<a id="chapter03_figure10" style="display: block;"></a><div class="image-container two-col-borderless" >
	
	<img src="/book/imgs/chapter03/ch03_10.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.10</p>
</div>
<a id="chapter03_figure11" style="display: block;"></a><div class="image-container two-col-borderless" >
	
	<img src="/book/imgs/chapter03/ch03_11.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.11</p>
</div>
<p>A pendulum is a bob suspended from a pivot.  Obviously a real-world pendulum would live in a 3D space, but we’re going to look at a simpler scenario, a pendulum in a 2D space—a Processing window (see Figure 3.10).</p>
<p><a id="accelerationangular-determining-824a9c50-253f-0130-bb56-7cd1c3f718ad" style="display: block;"></a><a id="angular-acceleration-824aad90-253f-0130-bb57-7cd1c3f718ad" style="display: block;"></a></p>
<p>In Chapter 2, we learned how a force (such as the force of gravity in Figure 3.11) causes an object to accelerate. <span class="mono">F = M * A</span> or <span class="mono">A = F / M</span>.  In this case, however, the pendulum bob doesn’t simply fall to the ground because it is attached by an arm to the pivot point.  And so, in order to determine its <em>angular</em> acceleration, we not only need to look at the force of gravity, but also the force at the angle of the pendulum’s arm (relative to a pendulum at rest with an angle of 0).</p>
<p>In the above case, since the pendulum’s arm is of fixed length, the only variable in the scenario is the angle.  We are going to simulate the pendulum’s motion through the use of angular velocity and acceleration.   The angular acceleration will be calculated using Newton’s second law with a little trigonometry twist.</p>
<p>Let’s zoom in on the right triangle from the pendulum diagram.</p>
<a id="chapter03_figure12" style="display: block;"></a><div class="image-container half-width-right" >
	
	<img src="/book/imgs/chapter03/ch03_12.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.12</p>
</div>
<p><a id="gravitymodeling-with-trigonometry-824ae4d0-253f-0130-bb58-7cd1c3f718ad" style="display: block;"></a></p>
<p>We can see that the force of the pendulum (<span class="var">F<sub>p</sub></span>) should point perpendicular to the arm of the pendulum in the direction that the pendulum is swinging.  After all, if there were no arm, the bob would just fall straight down.  It’s the tension force of the arm that keeps the bob accelerating towards the pendulum’s rest state. Since the force of gravity (<span class="var">F<sub>p</sub></span>) points downward, by making a right triangle out of these two vectors, we’ve accomplished something quite magnificent.  We’ve made the force of gravity the hypotenuse of a right triangle and separated the vector into two components, one of which represents the force of the pendulum.   Since sine equals opposite over hypotenuse, we have:</p>
<p><span class="formula">sine(θ) = F<sub>p</sub> / F<sub>g</sub></span></p>
<p>Therefore:</p>
<p><span class="formula">F<sub>p</sub> = F<sub>g</sub> * sine(θ)</span></p>
<p>Lest we forget, we’ve been doing all of this with a single question in mind:  What is the angular acceleration of the pendulum?    Once we have the angular acceleration, we’ll be able to apply our rules of motion to find the new angle for the pendulum.</p>
<p><span class="formula">angular velocity = angular velocity + angular acceleration</span><br /><span class="formula">angle = angle + angular velocity</span></p>
<p>The good news is that with Newton’s second law, we know that there is a relationship between force and acceleration, namely F = M * A, or A = F / M.  So if the force of the pendulum is equal to the force of gravity times sine of the angle, then:</p>
<p><span class="formula">pendulum angular acceleration = acceleration due to gravity * sine (θ)</span></p>
<p><a id="gravitymodeling-reality-vs-arbitrary-values-824b6aa0-253f-0130-bb59-7cd1c3f718ad" style="display: block;"></a><a id="natural-phenomenamodeling-reality-vs-arbitrary-values-824b8280-253f-0130-bb5a-7cd1c3f718ad" style="display: block;"></a></p>
<p>This is a good time to remind ourselves that we’re Processing programmers and not physicists.   Yes, we know that the acceleration due to gravity on earth is 9.8 meters per second squared.  But this number isn’t relevant to us.  What we have here is just an arbitrary constant (we’ll call it <span class="var">gravity</span>), one that we can use to scale the acceleration to something that feels right.</p>
<p><span class="formula">angular acceleration = gravity * sine(θ)</span></p>
<p>Amazing.  After all that, the formula is so simple.  You might be wondering, why bother going through the derivation at all?  I mean, learning is great and all, but we could have easily just said, "Hey, the angular acceleration of a pendulum is some constant times the sine of the angle."   This is just another moment in which we remind ourselves that the purpose of the book is not to learn how pendulums swing or gravity works.  The point is to think creatively about how things can move about the screen in a computationally based graphics system.  The pendulum is just a case study.   If you can understand the approach to programming a pendulum, then however you choose to design your onscreen world, you can apply the same techniques.</p>
<p>Of course, we’re not finished yet.  We may be happy with our simple, elegant formula, but we still have to apply it in code.   This is most definitely a good time to practice our object-oriented programming skills and create a <span class="klass">Pendulum</span> class.  Let’s think about all the properties we’ve encountered in our pendulum discussion that the class will need:</p>
<div class="list">
	
	<ul>
		
			<li><p>
arm length
</p>
</li>
		
			<li><p>
angle
</p>
</li>
		
			<li><p>
angular velocity
</p>
</li>
		
			<li><p>
angular acceleration
</p>
</li>
		
	</ul>
</div><div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>class Pendulum  {

  // Length of arm
  float r;
  // Pendulum arm angle
  float angle;
  // Angular velocity
  float aVelocity;
  // Angular acceleration
  float aAcceleration;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Pendulum</span>  <span class="o">{</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Length of arm</div><code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">r</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Pendulum arm angle</div><code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">angle</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Angular velocity</div><code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">aVelocity</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Angular acceleration</div><code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">aAcceleration</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>We’ll also need to write a function <span class="function">update()</span> to update the pendulum’s angle according to our formula…</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  void update() {
    // Arbitrary constant
    float gravity = 0.4;
    // Calculate acceleration according to our formula.
    aAcceleration = -1 * gravity * sin(angle);
    // Increment velocity.
    aVelocity += aAcceleration;
    // Increment angle.
    angle += aVelocity;
  }</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Arbitrary constant</div><code><pre><span class='one-line'>    <span class="kt">float</span> <span class="n">gravity</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Calculate acceleration according to our formula.</div><code><pre><span class='one-line'>    <span class="n">aAcceleration</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">gravity</span> <span class="o">*</span> <span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Increment velocity.</div><code><pre><span class='one-line'>    <span class="n">aVelocity</span> <span class="o">+=</span> <span class="n">aAcceleration</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Increment angle.</div><code><pre><span class='one-line'>    <span class="n">angle</span> <span class="o">+=</span> <span class="n">aVelocity</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><a id="chapter03_figure13" style="display: block;"></a><div class="image-container half-width-right" >
	
	<img src="/book/imgs/chapter03/ch03_13.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.13</p>
</div>
<p>…as well as a function <span class="function">display()</span> to draw the pendulum in the window. This begs the question: “Um, where do we draw the pendulum?”  We know the angle and the arm length, but how do we know the <em>x,y</em> (Cartesian!) coordinates for both the pendulum’s pivot point (let’s call it origin) and bob location (let’s call it location)?  This may be getting a little tiring, but the answer, yet again, is trigonometry.</p>
<p>The origin is just something we make up, as is the arm length.  Let’s say:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>PVector origin = new PVector(100,10);
float r = 125;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">origin</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span><span class="mi">10</span><span class="o">);</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">125</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>We’ve got the current angle stored in our variable <span class="var">angle</span>.   So relative to the origin, the pendulum’s location is a polar coordinate: <em>(r,angle)</em>.  And we need it to be Cartesian.  Luckily for us, we just spent some time (section 3.5) deriving the formula for converting from polar to Cartesian.  And so:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>PVector location = new PVector(r*sin(angle),r*cos(angle));</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">r</span><span class="o">*</span><span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">),</span><span class="n">r</span><span class="o">*</span><span class="n">cos</span><span class="o">(</span><span class="n">angle</span><span class="o">));</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Since the location is relative to wherever the origin happens to be, we can just add origin to the location <span class="klass">PVector</span>:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>location.add(origin);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">location</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">origin</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>And all that remains is the little matter of drawing a line and ellipse (you should be more creative, of course).</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>stroke(0);
fill(175);
line(origin.x,origin.y,location.x,location.y);
ellipse(location.x,location.y,16,16);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'><span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span>
<span class='one-line'><span class="n">line</span><span class="o">(</span><span class="n">origin</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">origin</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">);</span></span>
<span class='one-line'><span class="n">ellipse</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="mi">16</span><span class="o">,</span><span class="mi">16</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Before we put everything together, there’s one last little detail I neglected to mention.  Let’s think about the pendulum arm for a moment.  Is it a metal rod?  A string?  A rubber band?  How is it attached to the pivot point?  How long is it?  What is its mass?  Is it a windy day?  There are a lot of questions that we could continue to ask that would affect the simulation.  We’re living, of course, in a fantasy world, one where the pendulum’s arm is some idealized rod that never bends and the mass of the bob is concentrated in a single, infinitesimally small point.   Nevertheless, even though we don’t want to worry ourselves with all of the questions, we should add one more variable to our calculation of angular acceleration.   To keep things simple, in our derivation of the pendulum’s acceleration, we assumed that the length of the pendulum’s arm is 1.   In fact, the length of the pendulum’s arm affects the acceleration greatly: the longer the arm, the slower the acceleration.  To simulate a pendulum more accurately, we divide by that length, in this case <span class="var">r</span>.  For a more involved explanation, visit <a href="http://calculuslab.deltacollege.edu/ODE/7-A-2/7-A-2-h.html">The Simple Pendulum website</a>.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>aAcceleration = (-1 * G * sin(angle)) / r;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">aAcceleration</span> <span class="o">=</span> <span class="o">(-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">G</span> <span class="o">*</span> <span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">))</span> <span class="o">/</span> <span class="n">r</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="accelerationdamping-824c64f0-253f-0130-bb5b-7cd1c3f718ad" style="display: block;"></a><a id="damping-824c7760-253f-0130-bb5c-7cd1c3f718ad" style="display: block;"></a><a id="forcesdamping-824c8a60-253f-0130-bb5d-7cd1c3f718ad" style="display: block;"></a><a id="frictiondamping-824c9ca0-253f-0130-bb5e-7cd1c3f718ad" style="display: block;"></a></p>
<p>Finally, a real-world pendulum is going to experience some amount of friction (at the pivot point) and air resistance.   With our code as is, the pendulum would swing forever, so to make it more realistic we can use a “damping” trick.  I say <em>trick</em> because rather than model the resistance forces with some degree of accuracy (as we did in Chapter 2), we can achieve a similar result by simply reducing the angular velocity during each cycle.  The following code reduces the velocity by 1% (or multiplies it by 99%) during each frame of animation:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>aVelocity *= 0.99;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">aVelocity</span> <span class="o">*=</span> <span class="mf">0.99</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Putting everything together, we have the following example (with the pendulum beginning at a 45-degree angle).</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_10_PendulumExample/_3_10_PendulumExample.pde /book/processingjs/chapter03/_3_10_PendulumExample/Pendulum.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example10" style="display: block;"></a><span class="example">Example 3.10: Swinging pendulum</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>Pendulum p;

void setup() {
  size(640,360);
  // We make a new Pendulum object with
  // an origin location and arm length.
  p = new Pendulum(new PVector(width/2,10),125);
}

void draw() {
  background(255);
  p.go();
}

class Pendulum  {
  //[full] Many, many variables to keep track of the Pendulum’s various properties
  PVector location;    // Location of bob
  PVector origin;      // Location of arm origin
  float r;             // Length of arm
  float angle;         // Pendulum arm angle
  float aVelocity;     // Angle velocity
  float aAcceleration; // Angle acceleration
  float damping;       // Arbitrary damping amount
  //[end]

  Pendulum(PVector origin_, float r_) {
    origin = origin_.get();
    location = new PVector();
    r = r_;
    angle = PI/4;

    aVelocity = 0.0;
    aAcceleration = 0.0;
    // An arbitrary damping so that the Pendulum slows
    // over time
    damping = 0.995;
  }

  void go() {
    update();
    display();
  }

  void update() {
    float gravity = 0.4;
    //[offset-up] Formula we worked out for angular acceleration
    aAcceleration = (-1 * gravity / r) * sin(angle);

    //[full] Standard angular motion algorithm
    aVelocity += aAcceleration;
    angle += aVelocity;
    //[end]

    // Apply some damping.
    aVelocity *= damping;
  }

  void display() {
    // Where is the bob relative to the origin?
    // Polar to Cartesian coordinates will tell us!
    location.set(r*sin(angle),r*cos(angle),0);
    location.add(origin);

    stroke(0);
    // The arm
    line(origin.x,origin.y,location.x,location.y);
    fill(175);
    // The bob
    ellipse(location.x,location.y,16,16);
  }
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">Pendulum</span> <span class="n">p</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">size</span><span class="o">(</span><span class="mi">640</span><span class="o">,</span><span class="mi">360</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>We make a new Pendulum object with
an origin location and arm length.</div><code><pre><span class='one-line'>  <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Pendulum</span><span class="o">(</span><span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span><span class="mi">10</span><span class="o">),</span><span class="mi">125</span><span class="o">);</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">p</span><span class="o">.</span><span class="na">go</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kd">class</span> <span class="nc">Pendulum</span>  <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Many, many variables to keep track of the Pendulum’s various properties</div><code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">location</span><span class="o">;</span>    <span class="c1">// Location of bob</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">origin</span><span class="o">;</span>      <span class="c1">// Location of arm origin</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">r</span><span class="o">;</span>             <span class="c1">// Length of arm</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">angle</span><span class="o">;</span>         <span class="c1">// Pendulum arm angle</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">aVelocity</span><span class="o">;</span>     <span class="c1">// Angle velocity</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">aAcceleration</span><span class="o">;</span> <span class="c1">// Angle acceleration</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">damping</span><span class="o">;</span>       <span class="c1">// Arbitrary damping amount</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span>
<span class='one-line'>  <span class="n">Pendulum</span><span class="o">(</span><span class="n">PVector</span> <span class="n">origin_</span><span class="o">,</span> <span class="kt">float</span> <span class="n">r_</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">origin</span> <span class="o">=</span> <span class="n">origin_</span><span class="o">.</span><span class="na">get</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">location</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">r</span> <span class="o">=</span> <span class="n">r_</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">angle</span> <span class="o">=</span> <span class="n">PI</span><span class="o">/</span><span class="mi">4</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'>    <span class="n">aVelocity</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">aAcceleration</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>An arbitrary damping so that the Pendulum slows
over time</div><code><pre><span class='one-line'>    <span class="n">damping</span> <span class="o">=</span> <span class="mf">0.995</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="kt">void</span> <span class="nf">go</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">update</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">display</span><span class="o">();</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="kt">float</span> <span class="n">gravity</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair offset-up'><div class='code-comment '> Formula we worked out for angular acceleration</div><code><pre><span class='one-line'>    <span class="n">aAcceleration</span> <span class="o">=</span> <span class="o">(-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">gravity</span> <span class="o">/</span> <span class="n">r</span><span class="o">)</span> <span class="o">*</span> <span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Standard angular motion algorithm</div><code><pre><span class='one-line'>    <span class="n">aVelocity</span> <span class="o">+=</span> <span class="n">aAcceleration</span><span class="o">;</span></span>
<span class='one-line'>    <span class="n">angle</span> <span class="o">+=</span> <span class="n">aVelocity</span><span class="o">;</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Apply some damping.</div><code><pre><span class='one-line'>    <span class="n">aVelocity</span> <span class="o">*=</span> <span class="n">damping</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Where is the bob relative to the origin?
Polar to Cartesian coordinates will tell us!</div><code><pre><span class='one-line'>    <span class="n">location</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">r</span><span class="o">*</span><span class="n">sin</span><span class="o">(</span><span class="n">angle</span><span class="o">),</span><span class="n">r</span><span class="o">*</span><span class="n">cos</span><span class="o">(</span><span class="n">angle</span><span class="o">),</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">location</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">origin</span><span class="o">);</span></span>
<span class='one-line'> </span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>The arm</div><code><pre><span class='one-line'>    <span class="n">line</span><span class="o">(</span><span class="n">origin</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">origin</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">175</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>The bob</div><code><pre><span class='one-line'>    <span class="n">ellipse</span><span class="o">(</span><span class="n">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">location</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="mi">16</span><span class="o">,</span><span class="mi">16</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><em>(Note that the version of the example posted on the website has additional code to allow the user to grab the pendulum and swing it with the mouse.)</em></p>
<div class="example">
  <a id="chapter03_exercise12" style="display: block;"></a><h4 id="exercise-312">Exercise 3.12</h4><p>String together a series of pendulums so that the endpoint of one is the origin point of another.  Note that doing this may produce intriguing results but will be wildly inaccurate physically.  Simulating an actual double pendulum involves sophisticated equations, which you can read about here: <a href="http://scienceworld.wolfram.com/physics/DoublePendulum.html">http://scienceworld.wolfram.com/physics/DoublePendulum.html</a>.</p>

</div><div class="example">
  <a id="chapter03_exercise13" style="display: block;"></a><h4 id="exercise-313">Exercise 3.13</h4><div class="image-container half-width-right" >
	
	<img src="/book/imgs/chapter03/ch03_exc13.png" alt="Nature of Code Image" />
	
	
</div>
<p>Using trigonometry, what is the magnitude of the normal force in the illustration on the right (the force perpendicular to the incline on which the sled rests)?   Note that, as indicated, the “normal” force is a component of the force of gravity.</p>
<div class="image-container " >
	
	<img src="/book/imgs/blank.png" alt="Nature of Code Image" />
	
	
</div>

</div><div class="example">
  <a id="chapter03_exercise14" style="display: block;"></a><h4 id="exercise-314">Exercise 3.14</h4><p>Create an example that simulates a box sliding down the incline with friction.  Note that the magnitude of the friction force is equal to the normal force.</p>

</div></section><section><a id="chapter03_section10" style="display: block;"></a><h3 id="310-spring-forces">3.10 Spring Forces</h3><p><a id="forcessprings-824d0170-253f-0130-bb5f-7cd1c3f718ad" style="display: block;"></a><a id="springs-824d1250-253f-0130-bb60-7cd1c3f718ad" style="display: block;"></a></p>
<p>In <a href="#chapter03_section6">section 3.6</a>, we looked at modeling simple harmonic motion by mapping the sine wave to a pixel range. <a href="#chapter03_exercise6">Exercise 3.6</a> asked you to use this technique to create a simulation of a bob hanging from a spring.  While using the <span class="function">sin()</span> function is a quick-and-dirty, one-line-of-code way of getting something up and running, it won’t do if what we really want is to have a bob hanging from a spring in a two-dimensional space that responds to other forces in the environment (wind, gravity, etc.)  To accomplish a simulation like this (one that is identical to the pendulum example, only now the arm is a springy connection), we need to model the forces of a spring using <span class="klass">PVector</span>.</p>
<a id="chapter03_figure14" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_14.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.14</p>
</div>
<p><a id="forceshookes-law-824d4000-253f-0130-bb61-7cd1c3f718ad" style="display: block;"></a><a id="hookes-law-824d51e0-253f-0130-bb62-7cd1c3f718ad" style="display: block;"></a><a id="hooke-robert-824d60c0-253f-0130-bb63-7cd1c3f718ad" style="display: block;"></a><a id="springshookes-law-824d7810-253f-0130-bb64-7cd1c3f718ad" style="display: block;"></a></p>
<p>The force of a spring is calculated according to Hooke’s law, named for Robert Hooke, a British physicist who developed the formula in 1660.  Hooke originally stated the law in Latin:  "<em>Ut tensio, sic vis</em>," or “As the extension, so the force.”   Let’s think of it this way:</p>
<p><span class="highlight">The force of the spring is directly proportional to the extension of the spring.</span></p>
<a id="chapter03_figure15" style="display: block;"></a><div class="image-container half-width-right" >
	
	<img src="/book/imgs/chapter03/ch03_15.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.15: x = current length - rest length</p>
</div>
<p>In other words, if you pull on the bob a lot, the force will be strong; if you pull on the bob a little, the force will be weak.  Mathematically, the law is stated as follows:</p>
<p><a id="hookes-lawformula-for-expressing-824daa50-253f-0130-bb65-7cd1c3f718ad" style="display: block;"></a></p>
<p><span class="formula">F<sub>spring</sub> = - k * x</span></p>
<div class="list">
	
	<ul>
		
			<li><p><span class="var">k</span> is constant and its value will ultimately scale the force.  Is the spring highly elastic or quite rigid?
</p>
</li>
		
			<li><p><span class="var">x</span> refers to the displacement of the spring, i.e. the difference between the current length and the rest length.  The rest length is defined as the length of the spring in a state of equilibrium.
</p>
</li>
		
	</ul>
</div><p>Now remember, force is a vector, so we need to calculate both magnitude and direction.  Let’s look at one more diagram of the spring and label all the givens we might have in a Processing sketch.</p>
<a id="chapter03_figure16" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_16.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.16</p>
</div>
<p>Let’s establish the following three variables as shown in Figure 3.16.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>PVector anchor;
PVector location;
float restLength;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">anchor</span><span class="o">;</span></span>
<span class='one-line'><span class="n">PVector</span> <span class="n">location</span><span class="o">;</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">restLength</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="springsmagnitude-of-force-determining-824df2d0-253f-0130-bb66-7cd1c3f718ad" style="display: block;"></a></p>
<p>First, let’s use Hooke’s law to calculate the magnitude of the force.  We need to know <span class="var">k</span> and <span class="var">x</span>.  <span class="var">k</span> is easy; it’s just a constant, so let’s make something up.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>float k = 0.1;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">k</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="springsrest-length-824e2740-253f-0130-bb67-7cd1c3f718ad" style="display: block;"></a></p>
<p><span class="var">x</span> is perhaps a bit more difficult.  We need to know the “difference between the current length and the rest length.”  The rest length is defined as the variable <span class="var">restLength</span>.  What’s the current length?  The distance between the anchor and the bob.  And how can we calculate that distance?    How about the magnitude of a vector that points from the anchor to the bob?  (Note that this is exactly the same process we employed when calculating distance in Example 2.9: gravitational attraction.)</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>// A vector pointing from anchor to bob
// gives us the current length of the spring.
PVector dir = PVector.sub(bob,anchor);
float currentLength = dir.mag();
float x = restLength - currentLength;</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair '><div class='code-comment '>A vector pointing from anchor to bob
gives us the current length of the spring.</div><code><pre><span class='one-line'><span class="n">PVector</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">bob</span><span class="o">,</span><span class="n">anchor</span><span class="o">);</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">currentLength</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">restLength</span> <span class="o">-</span> <span class="n">currentLength</span><span class="o">;</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="springsdirection-of-force-determining-824e4d40-253f-0130-bb68-7cd1c3f718ad" style="display: block;"></a></p>
<p>Now that we’ve sorted out the elements necessary for the magnitude of the force (-1 * <span class="var">k</span> * <span class="var">x</span>), we need to figure out the direction, a unit vector pointing in the direction of the force.  The good news is that we already have this vector.  Right?  Just a moment ago we thought to ourselves: “How we can calculate that distance?  How about the magnitude of a vector that points from the anchor to the bob?”  Well, that is the direction of the force!</p>
<a id="chapter03_figure17" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_17.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.17</p>
</div>
<p>In Figure 3.17, we can see that if we stretch the spring beyond its rest length, there should be a force pulling it back towards the anchor.  And if it shrinks below its rest length, the force should push it away from the anchor.   This reversal of direction is accounted for in the formula with the -1.  And so all we need to do is normalize the <span class="klass">PVector</span> we used for the distance calculation!  Let’s take a look at the code and rename that <span class="klass">PVector</span> variable as “force.”</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>// Magnitude of spring force according to Hooke’s law
float k = 0.1;
PVector force = PVector.sub(bob,anchor);
float currentLength = dir.mag();
float x = restLength - currentLength;

// Direction of spring force (unit vector)
force.normalize();

// Putting it together: direction and magnitude!
force.mult(-1 * k * x);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair '><div class='code-comment '>Magnitude of spring force according to Hooke’s law</div><code><pre><span class='one-line'><span class="kt">float</span> <span class="n">k</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">;</span></span>
<span class='one-line'><span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">bob</span><span class="o">,</span><span class="n">anchor</span><span class="o">);</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">currentLength</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></span>
<span class='one-line'><span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">restLength</span> <span class="o">-</span> <span class="n">currentLength</span><span class="o">;</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Direction of spring force (unit vector)</div><code><pre><span class='one-line'><span class="n">force</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Putting it together: direction and magnitude!</div><code><pre><span class='one-line'><span class="n">force</span><span class="o">.</span><span class="na">mult</span><span class="o">(-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">x</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p><a id="object-oriented-programmingstructures-choosing-between-824e8d40-253f-0130-bb69-7cd1c3f718ad" style="display: block;"></a></p>
<p>Now that we have the algorithm worked out for computing the spring force vector, the question remains: what object-oriented programming structure should we use?   This, again, is one of those situations in which there is no “correct” answer.  There are several possibilities; which one we choose depends on the program’s goals and one’s own personal coding style.   Still, since we’ve been working all along with a <span class="klass">Mover</span> class, let’s keep going with this same framework.  Let’s think of our <span class="klass">Mover</span> class as the spring’s “bob.”  The bob needs <span class="var">location</span>, <span class="var">velocity</span>, and <span class="var">acceleration</span> vectors to move about the screen.  Perfect—we’ve got that already!  And perhaps the bob experiences a gravity force via the <span class="function">applyForce()</span> function.  Just one more step—we need to apply the spring force:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>Bob bob;

void setup() {
  bob = new Bob();
}

void draw()  {
  // Our Chapter 2 “make-up-a-gravity force”
  PVector gravity = new PVector(0,1);
  bob.applyForce(gravity);
  //[full] We need to also calculate and apply a spring force!
  PVector springForce = _______________????  //[bold]
  bob.applyForce(spring); //[bold]
  //[end]

  // Our standard update() and display() functions
  bob.update();
  bob.display();
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">Bob</span> <span class="n">bob</span><span class="o">;</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bob</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span>  <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Our Chapter 2 “make-up-a-gravity force”</div><code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">bob</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> We need to also calculate and apply a spring force!</div><code><pre><span class='one-line'>  <strong><span class="n">PVector</span> <span class="n">springForce</span> <span class="o">=</span> <span class="n">_______________</span><span class="o">????</span></strong></span>
<span class='one-line'>  <strong><span class="n">bob</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">spring</span><span class="o">);</span></strong></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Our standard update() and display() functions</div><code><pre><span class='one-line'>  <span class="n">bob</span><span class="o">.</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">bob</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><a id="chapter03_figure18" style="display: block;"></a><div class="image-container " >
	
	<img src="/book/imgs/chapter03/ch03_18.png" alt="Nature of Code Image" />
	
	<p class="caption">Figure 3.18</p>
</div>
<p>One option would be to write out all of the spring force code in the main <span class="function">draw()</span> loop.  But thinking ahead to when you might have multiple bobs and multiple spring connections, it makes a good deal of sense to write an additional class, a <span class="klass">Spring</span> class.  As shown in Figure 3.18, the <span class="klass">Bob</span> class keeps track of the movements of the bob; the <span class="klass">Spring</span> class keeps track of the spring’s anchor and its rest length and calculates the spring force on the bob.</p>
<p>This allows us to write a lovely main program as follows:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>Bob bob;
// Adding a Spring object
Spring spring;  //[bold]

void setup() {
  bob = new Bob();
  spring = new Spring();
}

void draw()  {
  PVector gravity = new PVector(0,1);
  bob.applyForce(gravity);

  // This new function in the Spring class will take care of
  // computing the force of the spring on the bob.
  spring.connect(bob); //[bold]

  bob.update();
  bob.display();
  spring.display();
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="n">Bob</span> <span class="n">bob</span><span class="o">;</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Adding a Spring object</div><code><pre><span class='one-line'><strong><span class="n">Spring</span> <span class="n">spring</span><span class="o">;</span></strong></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>  <span class="n">bob</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bob</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">spring</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Spring</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span>
<span class='one-line'> </span>
<span class='one-line'><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span>  <span class="o">{</span></span>
<span class='one-line'>  <span class="n">PVector</span> <span class="n">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">bob</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">gravity</span><span class="o">);</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>This new function in the Spring class will take care of
computing the force of the spring on the bob.</div><code><pre><span class='one-line'>  <strong><span class="n">spring</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">bob</span><span class="o">);</span></strong></span>
<span class='one-line'> </span>
<span class='one-line'>  <span class="n">bob</span><span class="o">.</span><span class="na">update</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">bob</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'>  <span class="n">spring</span><span class="o">.</span><span class="na">display</span><span class="o">();</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>You may notice here that this is quite similar to what we did in <a href="#chapter02_example6">Example 2.6</a> with an attractor.   There, we said something like:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  PVector force = attractor.attract(mover);
  mover.applyForce(force);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">attractor</span><span class="o">.</span><span class="na">attract</span><span class="o">(</span><span class="n">mover</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">mover</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>The analogous situation here with a spring would be:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  PVector force = spring.connect(bob);
  bob.applyForce(force);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">spring</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">bob</span><span class="o">);</span></span>
<span class='one-line'>  <span class="n">bob</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Nevertheless, in this example all we said was:</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  spring.connect(bob);</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="n">spring</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">bob</span><span class="o">);</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>What gives?   Why don’t we need to call <span class="function">applyForce()</span> on the bob?  The answer is, of course, that we do need to call <span class="function">applyForce()</span> on the bob.  Only instead of doing it in <span class="function">draw()</span>, we’re just demonstrating that a perfectly reasonable (and sometimes preferable) alternative is to ask the <span class="function">connect()</span> function to internally handle calling <span class="function">applyForce()</span> on the bob.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>  void connect(Bob b) {
    PVector force = some fancy calculations

    // The function connect() takes care of calling applyForce()
    // and therefore doesn’t have to return a vector to the calling
    // area.
    b.applyForce(force);
  }</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">connect</span><span class="o">(</span><span class="n">Bob</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span> <span class="n">some</span> <span class="n">fancy</span> <span class="n">calculations</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>The function connect() takes care of calling applyForce()
and therefore doesn’t have to return a vector to the calling
area.</div><code><pre><span class='one-line'>    <span class="n">b</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>Why do it one way with the <span class="klass">Attractor</span> class and another way with the <span class="klass">Spring</span> class?    When we were first learning about forces, it was a bit clearer to show all the forces being applied in the main <span class="function">draw()</span> loop, and hopefully this helped you learn about force accumulation.  Now that we’re more comfortable with that, perhaps it’s simpler to embed some of the details inside the objects themselves.</p>
<p>Let’s take a look at the rest of the elements in the <span class="klass">Spring</span> class.</p>
<div class="image-container screenshot" >
	
	<canvas data-processing-sources="/book/processingjs/chapter03/_3_11_spring/_3_11_spring.pde /book/processingjs/chapter03/_3_11_spring/Mover.pde /book/processingjs/chapter03/_3_11_spring/Spring.pde" class="screenshot">
		<p>Your browser does not support the canvas tag.</p>
	</canvas>
  <div class="sketch-controls">
    <button class="reset">RESET</button>
    <button class="pause">PAUSE</button>
  </div>
	
	
</div>
<p><a id="chapter03_example11" style="display: block;"></a><span class="example">Example 3.11: A Spring connection</span></p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>class Spring {

  // We need to keep track of the spring’s anchor location.
  PVector anchor;

  // Rest length and spring constant variables
  float len;
  float k = 0.1;

  //[full] The constructor initializes the anchor point and rest length.
  Spring(float x, float y, int l) {
    anchor = new PVector(x,y);
    len = l;
  }
  //[end]

  // Calculate spring force—our implementation of Hooke’s Law.
  void connect(Bob b) {

    //[full] Get a vector pointing from anchor to Bob location.
    PVector force = //[bold]
      PVector.sub(b.location,anchor); //[bold]
    //[end]
    float d = force.mag(); //[bold]
    // Calculate the displacement between
    // distance and rest length.
    float stretch = d - len; //[bold]

    //[full] Direction and magnitude together!
    force.normalize(); //[bold]
    force.mult(-1 * k * stretch); //[bold]
    //[end]

    // Call applyForce() right here!
    b.applyForce(force);
  }

  //[full] Draw the anchor.
  void display() {
    fill(100);
    rectMode(CENTER);
    rect(anchor.x,anchor.y,10,10);
  }
  //[end]

  //[full] Draw the spring connection between Bob location and anchor.
  void displayLine(Bob b) {
    stroke(255);
    line(b.location.x,b.location.y,anchor.x,anchor.y);
  }
  //[end]

}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kd">class</span> <span class="nc">Spring</span> <span class="o">{</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>We need to keep track of the spring’s anchor location.</div><code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">anchor</span><span class="o">;</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Rest length and spring constant variables</div><code><pre><span class='one-line'>  <span class="kt">float</span> <span class="n">len</span><span class="o">;</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">k</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">;</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> The constructor initializes the anchor point and rest length.</div><code><pre><span class='one-line'>  <span class="n">Spring</span><span class="o">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">int</span> <span class="n">l</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">anchor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PVector</span><span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">len</span> <span class="o">=</span> <span class="n">l</span><span class="o">;</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Calculate spring force—our implementation of Hooke’s Law.</div><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">connect</span><span class="o">(</span><span class="n">Bob</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Get a vector pointing from anchor to Bob location.</div><code><pre><span class='one-line'>    <strong><span class="n">PVector</span> <span class="n">force</span> <span class="o">=</span></strong></span>
<span class='one-line'>      <strong><span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">location</span><span class="o">,</span><span class="n">anchor</span><span class="o">);</span></strong></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'>    <strong><span class="kt">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></strong></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Calculate the displacement between
distance and rest length.</div><code><pre><span class='one-line'>    <strong><span class="kt">float</span> <span class="n">stretch</span> <span class="o">=</span> <span class="n">d</span> <span class="o">-</span> <span class="n">len</span><span class="o">;</span></strong></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Direction and magnitude together!</div><code><pre><span class='one-line'>    <strong><span class="n">force</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></strong></span>
<span class='one-line'>    <strong><span class="n">force</span><span class="o">.</span><span class="na">mult</span><span class="o">(-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">stretch</span><span class="o">);</span></strong></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Call applyForce() right here!</div><code><pre><span class='one-line'>    <span class="n">b</span><span class="o">.</span><span class="na">applyForce</span><span class="o">(</span><span class="n">force</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Draw the anchor.</div><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">display</span><span class="o">()</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">fill</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">rectMode</span><span class="o">(</span><span class="n">CENTER</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">rect</span><span class="o">(</span><span class="n">anchor</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">anchor</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">10</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair stretch'><div class='code-comment stretch'> Draw the spring connection between Bob location and anchor.</div><code><pre><span class='one-line'>  <span class="kt">void</span> <span class="nf">displayLine</span><span class="o">(</span><span class="n">Bob</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">stroke</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">line</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">location</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">b</span><span class="o">.</span><span class="na">location</span><span class="o">.</span><span class="na">y</span><span class="o">,</span><span class="n">anchor</span><span class="o">.</span><span class="na">x</span><span class="o">,</span><span class="n">anchor</span><span class="o">.</span><span class="na">y</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span></pre></code><div style='position:relative;clear:both;display:block;height:1px;width:100%;'></div></div>

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'> </span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div><p>The full code for this example is included on the book website, and the Web version also incorporates two additional features: (1) the <span class="klass">Bob</span> class includes functions for mouse interactivity so that the bob can be dragged around the window, and (2) the <span class="klass">Spring</span> object includes a function to constrain the connection’s length between a minimum and a maximum.</p>
<div class="example">
  <a id="chapter03_exercise15" style="display: block;"></a><h4 id="exercise-315">Exercise 3.15</h4><p>Before running to see the example online, take a look at this constrain function and see if you can fill in the blanks.</p>
<div class="source-code">
  <a class="toggle" href="#" data-to-raw='Show Raw' data-to-formatted='Show Formatted'>Show Raw</a>
  <textarea>void constrainLength(Bob b, float minlen, float maxlen) {
  // Vector pointing from Bob to Anchor
  PVector dir = PVector.sub(______,______);
  float d = dir.mag();

  // Is it too short?
  if (d < minlen) {
    dir.normalize();
    dir.mult(________);
    // Keep location within constraint.
    b.location = PVector.add(______,______);
    b.velocity.mult(0);
  // Is it too long?
  } else if (____________) {
    dir.normalize();
    dir.mult(_________);
    // Keep location within constraint.
    b.location = PVector.add(______,______);
    b.velocity.mult(0);
  }
}</textarea>
  
  
  
  <div class="code-block">

  <div class='code-comment-pair no-comment'><code><pre><span class='one-line'><span class="kt">void</span> <span class="nf">constrainLength</span><span class="o">(</span><span class="n">Bob</span> <span class="n">b</span><span class="o">,</span> <span class="kt">float</span> <span class="n">minlen</span><span class="o">,</span> <span class="kt">float</span> <span class="n">maxlen</span><span class="o">)</span> <span class="o">{</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Vector pointing from Bob to Anchor</div><code><pre><span class='one-line'>  <span class="n">PVector</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">sub</span><span class="o">(</span><span class="n">______</span><span class="o">,</span><span class="n">______</span><span class="o">);</span></span>
<span class='one-line'>  <span class="kt">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">mag</span><span class="o">();</span></span>
<span class='one-line'> </span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Is it too short?</div><code><pre><span class='one-line'>  <span class="k">if</span> <span class="o">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">minlen</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">dir</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">dir</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">________</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Keep location within constraint.</div><code><pre><span class='one-line'>    <span class="n">b</span><span class="o">.</span><span class="na">location</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">______</span><span class="o">,</span><span class="n">______</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">b</span><span class="o">.</span><span class="na">velocity</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Is it too long?</div><code><pre><span class='one-line'>  <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">____________</span><span class="o">)</span> <span class="o">{</span></span>
<span class='one-line'>    <span class="n">dir</span><span class="o">.</span><span class="na">normalize</span><span class="o">();</span></span>
<span class='one-line'>    <span class="n">dir</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="n">_________</span><span class="o">);</span></span></pre></code></div>

  <div class='code-comment-pair '><div class='code-comment '>Keep location within constraint.</div><code><pre><span class='one-line'>    <span class="n">b</span><span class="o">.</span><span class="na">location</span> <span class="o">=</span> <span class="n">PVector</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">______</span><span class="o">,</span><span class="n">______</span><span class="o">);</span></span>
<span class='one-line'>    <span class="n">b</span><span class="o">.</span><span class="na">velocity</span><span class="o">.</span><span class="na">mult</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></span>
<span class='one-line'>  <span class="o">}</span></span>
<span class='one-line'><span class="o">}</span></span></pre></code></div>

</div>
  <div style="position: relative;clear:both;display:block;height:1px;width:100%;"></div>
</div>
</div><div class="example">
  <a id="chapter03_exercise16" style="display: block;"></a><h4 id="exercise-316">Exercise 3.16</h4><p>Create a system of multiple bobs and spring connections.  How would you have a bob connected to a bob with no fixed anchor?</p>

</div><div style="page-break-after:always;"> </div><div class="tip">
  <h4 id="the-ecosystem-project">The Ecosystem Project</h4><p>Step 3 Exercise:</p>
<p>Take one of your creatures and incorporate oscillation into its motion.   You can use the <span class="klass">Oscillator</span> class from Example 3.7 as a model.  The <span class="klass">Oscillator</span> object, however, oscillates around a single point (the middle of the window).   Try oscillating around a moving point.   In other words, design a creature that moves around the screen according to location, velocity, and acceleration.  But that creature isn’t just a static shape, it’s an oscillating body.  Consider tying the speed of oscillation to the speed of motion.  Think of a butterfly’s flapping wings or the legs of an insect.  Can you make it appear that the creature’s internal mechanics (oscillation) drive its locomotion?   For a sample, check out the “AttractionArrayWithOscillation” example with the code download.</p>

</div><div style="page-break-after:always;"> </div></section>
  	</div>
  </div>

	<div id="bottom">
		<div id="footer">
			<div class="one-third" id="licenses">
        <h4>Licenses</h4>
        <p>
          <a class="license-badge" rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a>
          <a class="license-badge" rel="license" href="http://creativecommons.org/licenses/LGPL/2.1/"><img alt="LGPL License" style="border-width:0" src="http://www.gnu.org/graphics/lgplv3-88x31.png" /></a>
        </p>

        <p>
          The book's text and illustrations are licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.
        </p>

        <p>
          All of the book's source code is licensed under the <a rel="license" href="http://creativecommons.org/licenses/LGPL/2.1/">GNU Lesser General Public License</a> as published by the Free Software Foundation; either version 2.1 of the License, or (at your option) any later version.
        </p>

      </div>

      <div class="one-third">
        <h4>Colophon</h4>

        <p>This book was generated with <a href="https://github.com/runemadsen/Magic-Book-Project">The Magic Book Project</a>.

        <p>This book would not have been possible without the generous support of <a href="http://www.kickstarter.com/projects/shiffman/the-nature-of-code-book-project">Kickstarter</a> backers.</p> 

        <p>This book is typeset on the web in Georgia with headers in Proxima Nova.</p>

        <p>Please report any mistakes in the book or bugs in the source with a <a href="https://github.com/shiffman/The-Nature-of-Code/issues?sort=created&state=open">GitHub issue</a> or contact me at <span class="eml">daniel at shiffman dot net</span>.</p>
      </div>

      <div class="one-third">
        <h4>Author</h4>
        <p>Daniel Shiffman is a professor of the <a href="http://itp.nyu.edu/">Interactive Telecommunications Program</a> at New York University.</p>

        <p>He is the author of <a href="http://www.learningprocessing.com/">Learning Processing</a>.</p>

        <p><a href="https://twitter.com/shiffman">Twitter</a> <a href="http://github.com/shiffman">GitHub</a></p>
      </div>
		</div>
	</div>
</body>
</html>